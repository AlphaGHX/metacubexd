import{u as Y,f as E,i as r,c as s,$ as ee,a0 as te,a1 as ne,F as P,a2 as ae,S as se,a3 as oe,b as g,a4 as re,a5 as ce,U as le,j as A,e as H,E as ie,a6 as z,d as k,C as de,a7 as ue,h as ge,a8 as $e,a9 as me,l as pe,t as fe,r as be,g as he}from"./vendor-bcbfc1b2.js";import{c as ve,a as Ce}from"./index-8592a353.js";import{c as Se,f as W,g as xe,a as _e}from"./index-9f132d0e.js";import{d as G,f as X,B as V,u as ye,w as we,c as Ie,g as l}from"./index-6640ac5e.js";const Ee=g('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),Re=g('<input type="checkbox" id="connection-modal" class="modal-toggle">'),Oe=g('<div class="column self-stretch">'),De=g('<div class="sortable">'),Fe=g('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),Pe=t=>{const[o]=Y(),[m,b]=E(null),C=({draggable:c})=>b(c.id),L=({draggable:c,droppable:p})=>{if(c&&p){const i=t.order,d=i.indexOf(c.id),y=i.indexOf(p.id);if(d!==y){const S=i.slice();S.splice(y,0,...S.splice(d,1)),t.onOrderChange(S)}}},T=({key:c})=>{const p=re(c),[i]=ce();return(()=>{const d=Ee(),y=d.firstChild,S=y.firstChild,K=S.nextSibling;return le(p,d,()=>!0),r(S,()=>o(c)),K.addEventListener("change",h=>{t.onVisibleChange({...t.visible,[c]:h.target.checked})}),A(h=>{const N=!!p.isActiveDraggable,R=!!i.active.draggable;return N!==h._v$&&d.classList.toggle("opacity-25",h._v$=N),R!==h._v$2&&d.classList.toggle("transition-transform",h._v$2=R),h},{_v$:void 0,_v$2:void 0}),A(()=>K.checked=t.visible[c]),d})()};return[Re(),(()=>{const c=Fe(),p=c.firstChild;return r(p,s(oe,{onDragStart:C,onDragEnd:L,collisionDetector:ee,get children(){return[s(te,{}),(()=>{const i=Oe();return r(i,s(ne,{get ids(){return t.order},get children(){return s(P,{get each(){return t.order},children:d=>s(T,{key:d})})}})),i})(),s(ae,{get children(){return s(se,{get when(){return m()},get children(){const i=De();return r(i,()=>o(m())),i}})}})]}}),null),r(p,s(V,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(G),t.onVisibleChange(X)},get children(){return o("reset")}}),null),c})()]};var Le=async t=>{typeof t=="string"?await navigator.clipboard.writeText(t):await navigator.clipboard.write(t)};const q="[a-fA-F\\d:]",_=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${q})|(?<=${q})(?=\\s|$))`:"",$="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",a="[a-fA-F\\d]{1,4}",M=`
(?:
(?:${a}:){7}(?:${a}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${a}:){6}(?:${$}|:${a}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${a}:){5}(?::${$}|(?::${a}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${a}:){4}(?:(?::${a}){0,1}:${$}|(?::${a}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${a}:){3}(?:(?::${a}){0,2}:${$}|(?::${a}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${a}:){2}(?:(?::${a}){0,3}:${$}|(?::${a}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${a}:){1}(?:(?::${a}){0,4}:${$}|(?::${a}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${a}){0,5}:${$}|(?::${a}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Te=new RegExp(`(?:^${$}$)|(?:^${M}$)`),Ke=new RegExp(`^${$}$`),Ne=new RegExp(`^${M}$`),j=t=>t&&t.exact?Te:new RegExp(`(?:${_(t)}${$}${_(t)})|(?:${_(t)}${M}${_(t)})`,"g");j.v4=t=>t&&t.exact?Ke:new RegExp(`${_(t)}${$}${_(t)}`,"g");j.v6=t=>t&&t.exact?Ne:new RegExp(`${_(t)}${M}${_(t)}`,"g");function ke(t){const o=(...m)=>t(...m);return Object.defineProperty(o,"name",{value:`functionTimeout(${t.name||"<anonymous>"})`,configurable:!0}),o}const{toString:Ae}=Object.prototype;function Me(t){return Ae.call(t)==="[object RegExp]"}const J={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function Ve(t,o={}){if(!Me(t))throw new TypeError("Expected a RegExp instance");const m=Object.keys(J).map(C=>(typeof o[C]=="boolean"?o[C]:t[C])?J[C]:"").join(""),b=new RegExp(o.source||t.source,m);return b.lastIndex=typeof o.lastIndex=="number"?o.lastIndex:t.lastIndex,b}function je(t,o,{timeout:m}={}){try{return ke(()=>Ve(t).test(o),{timeout:m})()}catch(b){throw b}}const Be=45,Ue={timeout:400};function He(t){return t.length>Be?!1:je(j.v6({exact:!0}),t,Ue)}const ze=g('<div class="flex h-full items-center">'),We=g('<div class="flex flex-col gap-4"><div class="flex w-full items-center gap-2"><input class="input input-primary flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md"><table class="table table-xs rounded-none bg-base-200"><thead></thead><tbody>'),qe=g("<tr>"),Je=g('<th class="bg-base-300"><div>'),Ye=g("<span>"),Ge=g('<tr class="hover">'),Xe=g("<td>"),nt=()=>{const[t]=Y(),[o,m]=H(E(X),{name:"columnVisibility",storage:localStorage}),[b,C]=H(E(G),{name:"columnOrder",storage:localStorage}),L=ye(),[T,c]=E(""),p=ve(`${we()}/connections?token=${Ie()}`),i=Ce(p,"message"),[d,y]=E([]);ie(()=>{var n;const e=(n=i())==null?void 0:n.data;e&&y(O=>{const D=new Map;return O.forEach(f=>D.set(f.id,f)),JSON.parse(e).connections.map(f=>{const x=D.get(f.id);return x?{...f,downloadSpeed:x.download?f.download-x.download:0,uploadSpeed:x.upload?f.upload-x.upload:0}:{...f,downloadSpeed:0,uploadSpeed:0}}).slice(-100)})});const S=e=>L.delete(`connections/${e}`),K=[{accessorKey:l.Close,enableSorting:!1,header:()=>t("close"),cell:({row:e})=>(()=>{const n=ze();return r(n,s(V,{class:"btn-circle btn-xs",onClick:()=>S(e.id),get children(){return s(z,{size:"18"})}})),n})()},{accessorKey:l.ID,accessorFn:e=>e.id},{accessorKey:l.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{accessorKey:l.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{accessorKey:l.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{accessorKey:l.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{accessorKey:l.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{accessorKey:l.DlSpeed,accessorFn:e=>`${k(e.downloadSpeed)}/s`,sortingFn:(e,n)=>e.original.downloadSpeed-n.original.downloadSpeed},{accessorKey:l.ULSpeed,accessorFn:e=>`${k(e.uploadSpeed)}/s`,sortingFn:(e,n)=>e.original.uploadSpeed-n.original.uploadSpeed},{accessorKey:l.Download,accessorFn:e=>k(e.download),sortingFn:(e,n)=>e.original.download-n.original.download},{accessorKey:l.Upload,accessorFn:e=>k(e.upload),sortingFn:(e,n)=>e.original.upload-n.original.upload},{accessorKey:l.Source,accessorFn:e=>He(e.metadata.sourceIP)?`[${e.metadata.sourceIP}]:${e.metadata.sourcePort}`:`${e.metadata.sourceIP}:${e.metadata.sourcePort}`},{accessorKey:l.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}],[h,N]=E([{id:"ID",desc:!0}]),R=Se({state:{get columnOrder(){return b()},get sorting(){return h()},get columnVisibility(){return o()}},get data(){return T()?d().filter(e=>Object.values(e).some(n=>JSON.stringify(n).toLowerCase().includes(T().toLowerCase()))):d()},enableHiding:!0,columns:K,onSortingChange:N,getSortedRowModel:xe(),getCoreRowModel:_e()});return(()=>{const e=We(),n=e.firstChild,O=n.firstChild,D=O.nextSibling,B=n.nextSibling,f=B.firstChild,x=f.firstChild,Z=x.nextSibling;return O.$$input=v=>c(v.target.value),r(n,s(V,{class:"btn-circle",onClick:()=>L.delete("connections"),get children(){return s(z,{})}}),D),r(D,s(de,{})),r(n,s(Pe,{get order(){return b()},get visible(){return o()},onOrderChange:v=>{C([...v])},onVisibleChange:v=>m({...v})}),null),r(x,s(P,{get each(){return R.getHeaderGroups()},children:v=>(()=>{const F=qe();return r(F,s(P,{get each(){return v.headers},children:u=>(()=>{const w=Je(),I=w.firstChild;return ue(I,"click",u.column.getToggleSortingHandler(),!0),r(I,(()=>{const Q=ge(()=>u.column.id===l.Close);return()=>Q()?W(u.column.columnDef.header,u.getContext()):(()=>{const U=Ye();return r(U,()=>t(u.column.id)),U})()})(),null),r(I,()=>({asc:s($e,{}),desc:s(me,{})})[u.column.getIsSorted()]??null,null),A(()=>pe(I,fe("flex items-center justify-between gap-2",u.column.getCanSort()&&"cursor-pointer select-none"))),w})()})),F})()})),r(Z,s(P,{get each(){return R.getRowModel().rows},children:v=>(()=>{const F=Ge();return r(F,s(P,{get each(){return v.getVisibleCells()},children:u=>(()=>{const w=Xe();return w.$$contextmenu=I=>{I.preventDefault(),typeof u.renderValue()=="string"&&Le(u.renderValue())},r(w,()=>W(u.column.columnDef.cell,u.getContext())),w})()})),F})()})),A(()=>be(O,"placeholder",t("search"))),e})()};he(["input","click","contextmenu"]);export{nt as default};
