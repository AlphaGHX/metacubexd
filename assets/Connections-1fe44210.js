import{u as ve,c as b,i as o,e as s,X as ke,Y as Me,Z as Ae,F as N,_ as Ne,S as Ke,$ as Le,h as $,a0 as Ge,a1 as ze,M as Ve,f as K,V as We,x as le,a2 as ie,a as F,m as de,a3 as ue,y as ge,b as B,g as L,t as G,a4 as je,a5 as Be,v as He,a6 as ee,a7 as $e,a8 as me,a9 as Ue,aa as Ze,s as qe,d as Xe}from"./vendor-0ba45837.js";import{c as Ye}from"./index-8e593675.js";import{c as Je,f as H,g as Qe,a as et,b as tt,d as nt,e as st}from"./index-3bb352f2.js";import{l as pe}from"./lodash-9012c2c0.js";import{B as Z}from"./Button-df928f3b.js";import{d as fe,f as Ce,u as at,w as ot,c as rt,g as u,h as ct,t as lt,T as U}from"./index-93d42100.js";const it=$('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),dt=$('<input type="checkbox" id="connection-modal" class="modal-toggle">'),ut=$('<div class="column self-stretch">'),gt=$('<div class="sortable">'),$t=$('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),mt=e=>{const[l]=ve(),[S,y]=b(null),I=({draggable:g})=>y(g.id),X=({draggable:g,droppable:v})=>{if(g&&v){const m=e.order,p=m.indexOf(g.id),k=m.indexOf(v.id);if(p!==k){const f=m.slice();f.splice(k,0,...f.splice(p,1)),e.onOrderChange(f)}}},Y=({key:g})=>{const v=Ge(g),[m]=ze();return(()=>{const p=it(),k=p.firstChild,f=k.firstChild,V=f.nextSibling;return Ve(v,p,()=>!0),o(f,()=>l(g)),V.addEventListener("change",w=>{e.onVisibleChange({...e.visible,[g]:w.target.checked})}),K(w=>{const W=!!v.isActiveDraggable,j=!!m.active.draggable;return W!==w._v$&&p.classList.toggle("opacity-25",w._v$=W),j!==w._v$2&&p.classList.toggle("transition-transform",w._v$2=j),w},{_v$:void 0,_v$2:void 0}),K(()=>V.checked=e.visible[g]),p})()};return[dt(),(()=>{const g=$t(),v=g.firstChild;return o(v,s(Le,{onDragStart:I,onDragEnd:X,collisionDetector:ke,get children(){return[s(Me,{}),(()=>{const m=ut();return o(m,s(Ae,{get ids(){return e.order},get children(){return s(N,{get each(){return e.order},children:p=>s(Y,{key:p})})}})),m})(),s(Ne,{get children(){return s(Ke,{get when(){return S()},get children(){const m=gt();return o(m,()=>l(S())),m}})}})]}}),null),o(v,s(Z,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{e.onOrderChange(fe),e.onVisibleChange(Ce)},get children(){return l("reset")}}),null),g})()]};var pt=async e=>{typeof e=="string"?await navigator.clipboard.writeText(e):await navigator.clipboard.write(e)};const he="[a-fA-F\\d:]",P=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${he})|(?<=${he})(?=\\s|$))`:"",_="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",c="[a-fA-F\\d]{1,4}",q=`
(?:
(?:${c}:){7}(?:${c}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${c}:){6}(?:${_}|:${c}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${c}:){5}(?::${_}|(?::${c}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${c}:){4}(?:(?::${c}){0,1}:${_}|(?::${c}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${c}:){3}(?:(?::${c}){0,2}:${_}|(?::${c}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${c}:){2}(?:(?::${c}){0,3}:${_}|(?::${c}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${c}:){1}(?:(?::${c}){0,4}:${_}|(?::${c}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${c}){0,5}:${_}|(?::${c}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),ht=new RegExp(`(?:^${_}$)|(?:^${q}$)`),bt=new RegExp(`^${_}$`),vt=new RegExp(`^${q}$`),te=e=>e&&e.exact?ht:new RegExp(`(?:${P(e)}${_}${P(e)})|(?:${P(e)}${q}${P(e)})`,"g");te.v4=e=>e&&e.exact?bt:new RegExp(`${P(e)}${_}${P(e)}`,"g");te.v6=e=>e&&e.exact?vt:new RegExp(`${P(e)}${q}${P(e)}`,"g");function ft(e){const l=(...S)=>e(...S);return Object.defineProperty(l,"name",{value:`functionTimeout(${e.name||"<anonymous>"})`,configurable:!0}),l}const{toString:Ct}=Object.prototype;function _t(e){return Ct.call(e)==="[object RegExp]"}const be={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function St(e,l={}){if(!_t(e))throw new TypeError("Expected a RegExp instance");const S=Object.keys(be).map(I=>(typeof l[I]=="boolean"?l[I]:e[I])?be[I]:"").join(""),y=new RegExp(l.source||e.source,S);return y.lastIndex=typeof l.lastIndex=="number"?l.lastIndex:e.lastIndex,y}function xt(e,l,{timeout:S}={}){try{return ft(()=>St(e).test(l),{timeout:S})()}catch(y){throw y}}const yt=45,It={timeout:400};function wt(e){return e.length>yt?!1:xt(te.v6({exact:!0}),e,It)}const Et=$('<div class="flex h-4 items-center">'),Rt=$('<div class="flex h-full flex-col gap-4 overflow-y-auto p-1"><div class="tabs-boxed tabs gap-2"></div><div class="flex w-full flex-wrap items-center gap-2"><input class="input input-primary input-sm flex-1"><label for="connection-modal" class="btn btn-circle btn-sm"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),Ft=$("<button> (<!>)"),Dt=$("<tr>"),Ot=$('<th class="bg-base-200"><div><div>'),Pt=$('<button class="cursor-pointer">'),Tt=$('<tr class="h-8 hover:!bg-primary hover:text-primary-content">'),kt=$("<td>"),Mt=$("<button><div></div><div></div><div>(<!>)");var z=function(e){return e.activeConnections="activeConnections",e.closedConnections="closedConnections",e}(z||{});const Vt=()=>{const[e]=ve(),l=at(),[S,y]=b(""),[I,X]=b(z.activeConnections),Y=Ye(`${ot()}/connections?token=${rt()}`),g=We(Y,"message"),[v,m]=b([]),[p,k]=b([]),[f,V]=b(!1),[w,W]=b([]),[j,_e]=b([]);le(()=>{var r;const t=(r=g())==null?void 0:r.data;t&&k(D=>{const M=new Map;D.forEach(i=>M.set(i.id,i));const A=JSON.parse(t).connections.map(i=>{const x=M.get(i.id);return x?{...i,downloadSpeed:x.download?i.download-x.download:0,uploadSpeed:x.upload?i.upload-x.upload:0}:{...i,downloadSpeed:0,uploadSpeed:0}}),J=pe.differenceWith(D,A,(i,x)=>pe.isEqualWith(i,x,(Q,n)=>Q.id===n.id));return m(i=>[...i,...J].slice(-100)),A.slice(-100)})}),le(()=>{f()&&(W(ie(()=>p())),_e(ie(()=>v())))});const ne=F(()=>f()?w():p()),se=F(()=>f()?j():v()),Se=t=>l.delete(`connections/${t}`),[ae,xe]=de(b(Ce),{name:"columnVisibility",storage:localStorage}),[oe,ye]=de(b(fe),{name:"columnOrder",storage:localStorage}),Ie=[{header:()=>e("close"),enableGrouping:!1,enableSorting:!1,accessorKey:u.Close,cell:({row:t})=>(()=>{const r=Et();return o(r,s(Z,{class:"btn-circle btn-xs",onClick:()=>Se(t.id),get children(){return s(ue,{size:"16"})}})),r})()},{header:()=>e("ID"),enableGrouping:!1,accessorKey:u.ID,accessorFn:t=>t.id},{header:()=>e("type"),accessorKey:u.Type,accessorFn:t=>`${t.metadata.type}(${t.metadata.network})`},{header:()=>e("process"),accessorKey:u.Process,accessorFn:t=>t.metadata.process||t.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>e("host"),accessorKey:u.Host,accessorFn:t=>`${t.metadata.host?t.metadata.host:t.metadata.destinationIP}:${t.metadata.destinationPort}`},{header:()=>e("rules"),accessorKey:u.Rule,accessorFn:t=>t.rulePayload?`${t.rule} :: ${t.rulePayload}`:t.rule},{header:()=>e("chains"),accessorKey:u.Chains,accessorFn:t=>t.chains.slice().reverse().join(" :: ")},{header:()=>e("connectTime"),accessorKey:u.ConnectTime,accessorFn:t=>ct(t.start),sortingFn:(t,r)=>ge(t.original.start).valueOf()-ge(r.original.start).valueOf()},{header:()=>e("dlSpeed"),accessorKey:u.DlSpeed,accessorFn:t=>`${B(t.downloadSpeed)}/s`,sortingFn:(t,r)=>t.original.downloadSpeed-r.original.downloadSpeed},{header:()=>e("ulSpeed"),accessorKey:u.ULSpeed,accessorFn:t=>`${B(t.uploadSpeed)}/s`,sortingFn:(t,r)=>t.original.uploadSpeed-r.original.uploadSpeed},{header:()=>e("dl"),accessorKey:u.Download,accessorFn:t=>B(t.download),sortingFn:(t,r)=>t.original.download-r.original.download},{header:()=>e("ul"),accessorKey:u.Upload,accessorFn:t=>B(t.upload),sortingFn:(t,r)=>t.original.upload-r.original.upload},{header:()=>e("source"),accessorKey:u.Source,accessorFn:t=>wt(t.metadata.sourceIP)?`[${t.metadata.sourceIP}]:${t.metadata.sourcePort}`:`${t.metadata.sourceIP}:${t.metadata.sourcePort}`},{header:()=>e("destination"),accessorKey:u.Destination,accessorFn:t=>t.metadata.remoteDestination||t.metadata.destinationIP||t.metadata.host}],[we,Ee]=b([]),[Re,Fe]=b([{id:u.ConnectTime,desc:!0}]),re=Je({state:{get columnOrder(){return oe()},get grouping(){return we()},get sorting(){return Re()},get columnVisibility(){return ae()},get globalFilter(){return S()}},get data(){return I()===z.activeConnections?ne():se()},sortDescFirst:!0,enableHiding:!0,columns:Ie,onGlobalFilterChange:y,onGroupingChange:Ee,onSortingChange:Fe,getFilteredRowModel:Qe(),getSortedRowModel:et(),getExpandedRowModel:tt(),getGroupedRowModel:nt(),getCoreRowModel:st()}),De=()=>{const t=lt();let r="table-xs";switch(t){case U.XS:r="table-xs";break;case U.SM:r="table-sm";break;case U.MD:r="table-md";break;case U.LG:r="table-lg";break}return r},Oe=()=>[{type:z.activeConnections,name:e("activeConnections"),count:ne().length},{type:z.closedConnections,name:e("closedConnections"),count:se().length}];return(()=>{const t=Rt(),r=t.firstChild,D=r.nextSibling,M=D.firstChild,A=M.nextSibling,J=D.nextSibling,i=J.firstChild,x=i.firstChild,Q=x.nextSibling;return o(r,s(N,{get each(){return Oe()},children:n=>(()=>{const d=Ft(),a=d.firstChild,E=a.nextSibling;return E.nextSibling,d.$$click=()=>X(n.type),o(d,()=>n.name,a),o(d,()=>n.count,E),K(()=>L(d,G(I()===n.type&&"tab-active","tab tab-xs"))),d})()})),M.$$input=n=>y(n.target.value),o(D,s(Z,{class:"btn-circle btn-sm",onClick:()=>V(n=>!n),get children(){return F(()=>!!f())()?s(je,{}):s(Be,{})}}),A),o(D,s(Z,{class:"btn-circle btn-sm",onClick:()=>l.delete("connections"),get children(){return s(ue,{})}}),A),o(A,s(He,{})),o(D,s(mt,{get order(){return oe()},get visible(){return ae()},onOrderChange:n=>{ye([...n])},onVisibleChange:n=>xe({...n})}),null),o(x,s(N,{get each(){return re.getHeaderGroups()},children:n=>(()=>{const d=Dt();return o(d,s(N,{get each(){return n.headers},children:a=>(()=>{const E=Ot(),O=E.firstChild,C=O.firstChild;return o(O,(()=>{const h=F(()=>!!a.column.getCanGroup());return()=>h()?(()=>{const R=Pt();return ee(R,"click",a.column.getToggleGroupingHandler(),!0),o(R,(()=>{const T=F(()=>!!a.column.getIsGrouped());return()=>T()?s($e,{size:18}):s(me,{size:18})})()),R})():null})(),C),ee(C,"click",a.column.getToggleSortingHandler(),!0),o(C,()=>H(a.column.columnDef.header,a.getContext())),o(O,()=>({asc:s(Ue,{}),desc:s(Ze,{})})[a.column.getIsSorted()]??null,null),K(h=>{const R=G("flex items-center gap-2"),T=G(a.column.getCanSort()&&"cursor-pointer select-none","flex-1");return R!==h._v$3&&L(O,h._v$3=R),T!==h._v$4&&L(C,h._v$4=T),h},{_v$3:void 0,_v$4:void 0}),E})()})),d})()})),o(Q,s(N,{get each(){return re.getRowModel().rows},children:n=>(()=>{const d=Tt();return o(d,s(N,{get each(){return n.getVisibleCells()},children:a=>(()=>{const E=kt();return E.$$contextmenu=O=>{O.preventDefault(),typeof a.renderValue()=="string"&&pt(a.renderValue())},o(E,(()=>{const O=F(()=>!!a.getIsGrouped());return()=>O()?(()=>{const C=Mt(),h=C.firstChild,R=h.nextSibling,T=R.nextSibling,Pe=T.firstChild,ce=Pe.nextSibling;return ce.nextSibling,ee(C,"click",n.getToggleExpandedHandler(),!0),o(h,(()=>{const Te=F(()=>!!n.getIsExpanded());return()=>Te()?s($e,{size:18}):s(me,{size:18})})()),o(R,()=>H(a.column.columnDef.cell,a.getContext())),o(T,()=>n.subRows.length,ce),K(()=>L(C,G(n.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),C})():(()=>{const C=F(()=>!!a.getIsAggregated());return()=>C()?H(a.column.columnDef.aggregatedCell??a.column.columnDef.cell,a.getContext()):(()=>{const h=F(()=>!!a.getIsPlaceholder());return()=>h()?null:H(a.column.columnDef.cell,a.getContext())})()})()})()),E})()})),d})()})),K(n=>{const d=e("search"),a=G(De(),"table table-zebra relative rounded-none");return d!==n._v$&&qe(M,"placeholder",n._v$=d),a!==n._v$2&&L(i,n._v$2=a),n},{_v$:void 0,_v$2:void 0}),t})()};Xe(["input","click","contextmenu"]);export{Vt as default};
