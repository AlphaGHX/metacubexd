import{u as G,e as I,i as r,c as s,_ as te,$ as ne,a0 as se,F as D,a1 as ae,S as oe,a2 as re,b as u,a3 as ce,a4 as le,T as ie,h as A,d as z,D as de,a5 as H,Y as k,B as ue,a6 as ge,g as $e,a7 as me,a8 as pe,j as be,t as fe,q as he,f as ve}from"./vendor-38af4582.js";import{c as Ce,a as Se}from"./index-bbed7c8e.js";import{c as _e,f as q,g as xe,a as ye}from"./index-2ddaefcb.js";import{C as X,c as Z,B as j,u as Ie,w as we,b as Ee,d as l}from"./index-7f7dbcee.js";const Re=u('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),Oe=u('<input type="checkbox" id="connection-modal" class="modal-toggle">'),De=u('<div class="column self-stretch">'),Fe=u('<div class="sortable">'),Pe=u('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),Le=t=>{const[o]=G(),[$,f]=I(null),C=({draggable:c})=>f(c.id),F=({draggable:c,droppable:m})=>{if(c&&m){const i=t.order,d=i.indexOf(c.id),y=i.indexOf(m.id);if(d!==y){const S=i.slice();S.splice(y,0,...S.splice(d,1)),t.onOrderChange(S)}}},P=({key:c})=>{const m=ce(c),[i]=le();return(()=>{const d=Re(),y=d.firstChild,S=y.firstChild,L=S.nextSibling;return ie(m,d,()=>!0),r(S,()=>o(c)),L.addEventListener("change",h=>{t.onVisibleChange({...t.visible,[c]:h.target.checked})}),A(h=>{const T=!!m.isActiveDraggable,w=!!i.active.draggable;return T!==h._v$&&d.classList.toggle("opacity-25",h._v$=T),w!==h._v$2&&d.classList.toggle("transition-transform",h._v$2=w),h},{_v$:void 0,_v$2:void 0}),A(()=>L.checked=t.visible[c]),d})()};return[Oe(),(()=>{const c=Pe(),m=c.firstChild;return r(m,s(re,{onDragStart:C,onDragEnd:F,collisionDetector:te,get children(){return[s(ne,{}),(()=>{const i=De();return r(i,s(se,{get ids(){return t.order},get children(){return s(D,{get each(){return t.order},children:d=>s(P,{key:d})})}})),i})(),s(ae,{get children(){return s(oe,{get when(){return $()},get children(){const i=Fe();return r(i,()=>o($())),i}})}})]}}),null),r(m,s(j,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(X),t.onVisibleChange(Z)},get children(){return o("reset")}}),null),c})()]},W="[a-fA-F\\d:]",x=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${W})|(?<=${W})(?=\\s|$))`:"",g="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",n="[a-fA-F\\d]{1,4}",M=`
(?:
(?:${n}:){7}(?:${n}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${n}:){6}(?:${g}|:${n}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${n}:){5}(?::${g}|(?::${n}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${n}:){4}(?:(?::${n}){0,1}:${g}|(?::${n}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${n}:){3}(?:(?::${n}){0,2}:${g}|(?::${n}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${n}:){2}(?:(?::${n}){0,3}:${g}|(?::${n}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${n}:){1}(?:(?::${n}){0,4}:${g}|(?::${n}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${n}){0,5}:${g}|(?::${n}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Te=new RegExp(`(?:^${g}$)|(?:^${M}$)`),Ke=new RegExp(`^${g}$`),Ne=new RegExp(`^${M}$`),V=t=>t&&t.exact?Te:new RegExp(`(?:${x(t)}${g}${x(t)})|(?:${x(t)}${M}${x(t)})`,"g");V.v4=t=>t&&t.exact?Ke:new RegExp(`${x(t)}${g}${x(t)}`,"g");V.v6=t=>t&&t.exact?Ne:new RegExp(`${x(t)}${M}${x(t)}`,"g");function ke(t){const o=(...$)=>t(...$);return Object.defineProperty(o,"name",{value:`functionTimeout(${t.name||"<anonymous>"})`,configurable:!0}),o}const{toString:Ae}=Object.prototype;function Me(t){return Ae.call(t)==="[object RegExp]"}const Y={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function je(t,o={}){if(!Me(t))throw new TypeError("Expected a RegExp instance");const $=Object.keys(Y).map(C=>(typeof o[C]=="boolean"?o[C]:t[C])?Y[C]:"").join(""),f=new RegExp(o.source||t.source,$);return f.lastIndex=typeof o.lastIndex=="number"?o.lastIndex:t.lastIndex,f}function Ve(t,o,{timeout:$}={}){try{return ke(()=>je(t).test(o),{timeout:$})()}catch(f){throw f}}const Be=45,Ue={timeout:400};function ze(t){return t.length>Be?!1:Ve(V.v6({exact:!0}),t,Ue)}const J=u('<div class="flex h-full items-center">'),He=u('<div class="flex flex-col gap-4"><div class="flex w-full"><input class="input input-primary mr-4 w-40 flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md"><table class="table table-xs rounded-none bg-base-200"><thead></thead><tbody>'),qe=u("<tr>"),We=u('<th class="bg-base-300"><div>'),Ye=u("<span>"),Je=u('<tr class="hover">'),Ge=u("<td>"),tt=()=>{const[t]=G(),[o,$]=z(I(Z),{name:"columnVisibility",storage:localStorage}),[f,C]=z(I(X),{name:"columnOrder",storage:localStorage}),F=Ie(),[P,c]=I(""),m=Ce(`${we()}/connections?token=${Ee()}`),i=Se(m,"message"),[d,y]=I([]);de(()=>{var a;const e=(a=i())==null?void 0:a.data;e&&y(E=>{const K=new Map;return E.forEach(p=>K.set(p.id,p)),JSON.parse(e).connections.map(p=>{const _=K.get(p.id);return _?{...p,downloadSpeed:_.download?p.download-_.download:0,uploadSpeed:_.upload?p.upload-_.upload:0}:{...p,downloadSpeed:0,uploadSpeed:0}}).slice(-100)})});const S=e=>F.delete(`connections/${e}`),L=[{accessorKey:l.Close,header:()=>(()=>{const e=J();return r(e,s(j,{class:"btn-circle btn-xs",onClick:()=>F.delete("connections"),get children(){return s(H,{size:"18"})}})),e})(),cell:({row:e})=>(()=>{const a=J();return r(a,s(j,{class:"btn-circle btn-xs",onClick:()=>S(e.id),get children(){return s(H,{size:"18"})}})),a})()},{accessorKey:l.ID,accessorFn:e=>e.id},{accessorKey:l.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{accessorKey:l.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{accessorKey:l.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{accessorKey:l.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{accessorKey:l.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{accessorKey:l.DlSpeed,accessorFn:e=>`${k(e.downloadSpeed)}/s`,sortingFn:(e,a)=>e.original.downloadSpeed-a.original.downloadSpeed},{accessorKey:l.ULSpeed,accessorFn:e=>`${k(e.uploadSpeed)}/s`,sortingFn:(e,a)=>e.original.uploadSpeed-a.original.uploadSpeed},{accessorKey:l.Download,accessorFn:e=>k(e.download),sortingFn:(e,a)=>e.original.download-a.original.download},{accessorKey:l.Upload,accessorFn:e=>k(e.upload),sortingFn:(e,a)=>e.original.upload-a.original.upload},{accessorKey:l.Source,accessorFn:e=>ze(e.metadata.sourceIP)?`[${e.metadata.sourceIP}]:${e.metadata.sourcePort}`:`${e.metadata.sourceIP}:${e.metadata.sourcePort}`},{accessorKey:l.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}],[h,T]=I([{id:"ID",desc:!0}]),w=_e({state:{get columnOrder(){return f()},get sorting(){return h()},get columnVisibility(){return o()}},get data(){return P()?d().filter(e=>Object.values(e).some(a=>JSON.stringify(a).toLowerCase().includes(P().toLowerCase()))):d()},enableHiding:!0,columns:L,onSortingChange:T,getSortedRowModel:xe(),getCoreRowModel:ye()});return(()=>{const e=He(),a=e.firstChild,E=a.firstChild,K=E.nextSibling,B=a.nextSibling,p=B.firstChild,_=p.firstChild,Q=_.nextSibling;return E.$$input=v=>c(v.target.value),r(K,s(ue,{})),r(a,s(Le,{get order(){return f()},get visible(){return o()},onOrderChange:v=>{C([...v])},onVisibleChange:v=>$({...v})}),null),r(_,s(D,{get each(){return w.getHeaderGroups()},children:v=>(()=>{const R=qe();return r(R,s(D,{get each(){return v.headers},children:b=>(()=>{const O=We(),N=O.firstChild;return ge(N,"click",b.column.getToggleSortingHandler(),!0),r(N,(()=>{const ee=$e(()=>b.column.id===l.Close);return()=>ee()?q(b.column.columnDef.header,b.getContext()):(()=>{const U=Ye();return r(U,()=>t(b.column.id)),U})()})(),null),r(N,()=>({asc:s(me,{}),desc:s(pe,{})})[b.column.getIsSorted()]??null,null),A(()=>be(N,fe("flex items-center justify-between",b.column.getCanSort()&&"cursor-pointer select-none"))),O})()})),R})()})),r(Q,s(D,{get each(){return w.getRowModel().rows},children:v=>(()=>{const R=Je();return r(R,s(D,{get each(){return v.getVisibleCells()},children:b=>(()=>{const O=Ge();return r(O,()=>q(b.column.columnDef.cell,b.getContext())),O})()})),R})()})),A(()=>he(E,"placeholder",t("search"))),e})()};ve(["input","click"]);export{tt as default};
