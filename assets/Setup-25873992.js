import{p as B,D as F,E as z,Q as A,i as d,h,U as P,F as q,o as C,V as U,g as H,k as M}from"./vendor-1082ac4c.js";import{c as N,v as Q,z as b}from"./index-f10da739.js";import{B as _}from"./Button-6cdc8c17.js";import{e as m,s as v,a as T,b as E}from"./index-8416a89c.js";import{t as X}from"./global-6c188e99.js";let f;const G=new Uint8Array(16);function J(){if(!f&&(f=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!f))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(G)}const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function K(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}const O=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),S={randomUUID:O};function W(t,e,a){if(S.randomUUID&&!e&&!t)return S.randomUUID();t=t||{};const i=t.random||(t.rng||J)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){a=a||0;for(let c=0;c<16;++c)e[a+c]=i[c];return e}return K(i)}const Y=C('<div class="mx-auto flex max-w-screen-md flex-col items-center gap-4 py-10"><form class="contents"><div class="flex w-full flex-col gap-4"><div class="flex-1"><label class="label"><span class="label-text"></span></label><input name="url" type="url" class="input input-bordered w-full" placeholder="http://127.0.0.1:9090" list="defaultEndpoints"><datalist id="defaultEndpoints"><option value="http://127.0.0.1:9090"></option></datalist></div><div class="flex-1"><label class="label"><span class="label-text"></span></label><input name="secret" type="password" class="input input-bordered w-full" placeholder="secret"></div></div></form><div class="flex w-full flex-col gap-4">'),Z=C('<div class="badge badge-info flex w-full cursor-pointer items-center gap-4 py-4">'),tt=b.object({url:b.string().nonempty(),secret:b.string()}),it=()=>{const[t]=B(),e=F(),a=n=>{E(n),e("/overview")},i=(n,s)=>M.get(n,{headers:s?{Authorization:`Bearer ${s}`}:{}}).then(({ok:l})=>l).catch(l=>{const{message:r}=l;U.error(r)}),c=async n=>{const s=m().find(l=>l.id===n);s&&await i(s.url,s.secret)&&a(n)},x=async({url:n,secret:s})=>{const l=X(n);if(!await i(l,s))return;const r=W(),p=m().slice(),u=p.find(y=>y.url===l);if(!u){v([{id:r,url:l,secret:s},...p]),a(r);return}u.secret=s,u.id=r,v(p),a(r)},R=n=>{const{message:s}=n;U.error(s)},{form:w}=N({extend:Q({schema:tt}),onSubmit:x,onError:R}),I=n=>{T()===n&&E(""),v(m().filter(s=>s.id!==n))};return z(()=>{const n=new URLSearchParams(window.location.search);n.has("hostname")?x({url:`${window.location.protocol}//${n.get("hostname")}${n.get("port")?`:${n.get("port")}`:""}`,secret:n.get("secret")??""}):m().length===0&&x({url:"http://127.0.0.1:9090",secret:""})}),(()=>{const n=Y(),s=n.firstChild,l=s.firstChild,r=l.firstChild,p=r.firstChild,u=p.firstChild,y=r.nextSibling,L=y.firstChild,k=L.firstChild,D=s.nextSibling;return A(w,s,()=>w),d(u,()=>t("endpointURL")),d(k,()=>t("secret")),d(l,h(_,{type:"submit",class:"btn-primary join-item uppercase",get children(){return t("add")}}),null),d(D,h(q,{get each(){return m()},children:({id:$,url:V})=>(()=>{const g=Z();return g.$$click=()=>c($),d(g,V,null),d(g,h(_,{class:"btn-circle btn-ghost btn-xs text-white",onClick:j=>{j.stopPropagation(),I($)},get children(){return h(P,{})}}),null),g})()})),n})()};H(["click"]);export{it as default};
