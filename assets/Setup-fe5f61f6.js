import{u as k,o as C,H as R,U as D,i as m,c as g,V,F as L,b as U,g as j,k as B}from"./vendor-bcbfc1b2.js";import{c as F,v as z,z as v}from"./index-f06daa74.js";import{B as S,e as h,s as w,a as A}from"./index-16756fb8.js";let y;const H=new Uint8Array(16);function P(){if(!y&&(y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(H)}const i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));function q(t,e=0){return(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase()}const M=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),f={randomUUID:M};function N(t,e,c){if(f.randomUUID&&!e&&!t)return f.randomUUID();t=t||{};const s=t.random||(t.rng||P)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){c=c||0;for(let l=0;l<16;++l)e[c+l]=s[l];return e}return q(s)}const T=U('<div class="mx-auto flex flex-col items-center gap-4 py-10 sm:w-2/3"><form class="contents"><div class="flex w-full flex-col gap-4"><input name="url" type="url" class="input input-bordered" placeholder="host url" list="defaultEndpoints"><datalist id="defaultEndpoints"><option value="http://127.0.0.1:9090"></option></datalist><input name="secret" type="password" class="input input-bordered" placeholder="secret"></div></form><div class="flex w-full flex-col gap-4">'),X=U('<div class="badge badge-info flex w-full cursor-pointer items-center gap-4 py-4">'),G=v.object({url:v.string().url().nonempty(),secret:v.string()}),Q=()=>{const[t]=k(),e=C(),c=n=>{A(n),e("/overview")},s=(n,o)=>B.get(n,{headers:o?{Authorization:`Bearer ${o}`}:{}}).then(({ok:r})=>r).catch(()=>!1),l=async n=>{const o=h().find(r=>r.id===n);o&&await s(o.url,o.secret)&&c(n)},x=async({url:n,secret:o})=>{const r=h().slice(),d=r.find(a=>a.url===n);if(d){const{id:a,secret:u}=d;o!==u&&!await s(n,o)&&(d.secret=o,w(r)),c(a);return}if(!await s(n,o))return;const b=N();w([{id:b,url:n,secret:o},...r]),c(b)},{form:$}=F({extend:z({schema:G}),onSubmit:x}),_=n=>w(h().filter(o=>o.id!==n));return R(()=>{const n=new URLSearchParams(window.location.search);n.has("hostname")?x({url:`http://${n.get("hostname")}${n.get("port")&&":"+n.get("port")}`,secret:n.get("secret")??""}):x({url:"http://127.0.0.1:9090",secret:""})}),(()=>{const n=T(),o=n.firstChild,r=o.firstChild;r.firstChild.nextSibling.nextSibling;const a=o.nextSibling;return D($,o,()=>$),m(r,g(S,{type:"submit",class:"btn-primary join-item uppercase",get children(){return t("add")}}),null),m(a,g(L,{get each(){return h()},children:({id:u,url:E})=>(()=>{const p=X();return p.$$click=()=>l(u),m(p,E,null),m(p,g(S,{class:"btn-circle btn-ghost btn-xs text-white",onClick:I=>{I.stopPropagation(),_(u)},get children(){return g(V,{})}}),null),p})()})),n})()};j(["click"]);export{Q as default};
