import{u as G,f as E,i as o,c as s,$ as te,a0 as ne,a1 as ae,F as P,a2 as se,S as oe,a3 as re,b as g,a4 as ce,a5 as le,U as ie,j as A,e as H,E as de,a6 as z,d as k,C as ue,a7 as ge,h as $e,a8 as me,a9 as pe,l as fe,t as be,r as he,g as ve}from"./vendor-bcbfc1b2.js";import{c as Ce,a as Se}from"./index-8592a353.js";import{c as xe,f as W,g as _e,a as ye}from"./index-9f132d0e.js";import{d as X,f as Z,B as V,u as we,w as Ie,c as Ee,g as l}from"./index-29cbe793.js";const Re=g('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),Oe=g('<input type="checkbox" id="connection-modal" class="modal-toggle">'),De=g('<div class="column self-stretch">'),Fe=g('<div class="sortable">'),Pe=g('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),Le=t=>{const[r]=G(),[m,b]=E(null),C=({draggable:c})=>b(c.id),L=({draggable:c,droppable:p})=>{if(c&&p){const i=t.order,d=i.indexOf(c.id),y=i.indexOf(p.id);if(d!==y){const S=i.slice();S.splice(y,0,...S.splice(d,1)),t.onOrderChange(S)}}},T=({key:c})=>{const p=ce(c),[i]=le();return(()=>{const d=Re(),y=d.firstChild,S=y.firstChild,K=S.nextSibling;return ie(p,d,()=>!0),o(S,()=>r(c)),K.addEventListener("change",h=>{t.onVisibleChange({...t.visible,[c]:h.target.checked})}),A(h=>{const N=!!p.isActiveDraggable,R=!!i.active.draggable;return N!==h._v$&&d.classList.toggle("opacity-25",h._v$=N),R!==h._v$2&&d.classList.toggle("transition-transform",h._v$2=R),h},{_v$:void 0,_v$2:void 0}),A(()=>K.checked=t.visible[c]),d})()};return[Oe(),(()=>{const c=Pe(),p=c.firstChild;return o(p,s(re,{onDragStart:C,onDragEnd:L,collisionDetector:te,get children(){return[s(ne,{}),(()=>{const i=De();return o(i,s(ae,{get ids(){return t.order},get children(){return s(P,{get each(){return t.order},children:d=>s(T,{key:d})})}})),i})(),s(se,{get children(){return s(oe,{get when(){return m()},get children(){const i=Fe();return o(i,()=>r(m())),i}})}})]}}),null),o(p,s(V,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(X),t.onVisibleChange(Z)},get children(){return r("reset")}}),null),c})()]};var Te=async t=>{typeof t=="string"?await navigator.clipboard.writeText(t):await navigator.clipboard.write(t)};const q="[a-fA-F\\d:]",_=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${q})|(?<=${q})(?=\\s|$))`:"",$="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",a="[a-fA-F\\d]{1,4}",M=`
(?:
(?:${a}:){7}(?:${a}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${a}:){6}(?:${$}|:${a}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${a}:){5}(?::${$}|(?::${a}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${a}:){4}(?:(?::${a}){0,1}:${$}|(?::${a}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${a}:){3}(?:(?::${a}){0,2}:${$}|(?::${a}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${a}:){2}(?:(?::${a}){0,3}:${$}|(?::${a}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${a}:){1}(?:(?::${a}){0,4}:${$}|(?::${a}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${a}){0,5}:${$}|(?::${a}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Ke=new RegExp(`(?:^${$}$)|(?:^${M}$)`),Ne=new RegExp(`^${$}$`),ke=new RegExp(`^${M}$`),j=t=>t&&t.exact?Ke:new RegExp(`(?:${_(t)}${$}${_(t)})|(?:${_(t)}${M}${_(t)})`,"g");j.v4=t=>t&&t.exact?Ne:new RegExp(`${_(t)}${$}${_(t)}`,"g");j.v6=t=>t&&t.exact?ke:new RegExp(`${_(t)}${M}${_(t)}`,"g");function Ae(t){const r=(...m)=>t(...m);return Object.defineProperty(r,"name",{value:`functionTimeout(${t.name||"<anonymous>"})`,configurable:!0}),r}const{toString:Me}=Object.prototype;function Ve(t){return Me.call(t)==="[object RegExp]"}const J={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function je(t,r={}){if(!Ve(t))throw new TypeError("Expected a RegExp instance");const m=Object.keys(J).map(C=>(typeof r[C]=="boolean"?r[C]:t[C])?J[C]:"").join(""),b=new RegExp(r.source||t.source,m);return b.lastIndex=typeof r.lastIndex=="number"?r.lastIndex:t.lastIndex,b}function Be(t,r,{timeout:m}={}){try{return Ae(()=>je(t).test(r),{timeout:m})()}catch(b){throw b}}const Ue=45,He={timeout:400};function ze(t){return t.length>Ue?!1:Be(j.v6({exact:!0}),t,He)}const Y=g("<span>"),We=g('<div class="flex h-full items-center">'),qe=g('<div class="flex flex-col gap-4"><div class="flex w-full items-center gap-2"><input class="input input-primary flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md"><table class="table table-xs rounded-none bg-base-200"><thead></thead><tbody>'),Je=g("<tr>"),Ye=g('<th class="bg-base-300"><div>'),Ge=g('<tr class="hover">'),Xe=g("<td>"),nt=()=>{const[t]=G(),[r,m]=H(E(Z),{name:"columnVisibility",storage:localStorage}),[b,C]=H(E(X),{name:"columnOrder",storage:localStorage}),L=we(),[T,c]=E(""),p=Ce(`${Ie()}/connections?token=${Ee()}`),i=Se(p,"message"),[d,y]=E([]);de(()=>{var n;const e=(n=i())==null?void 0:n.data;e&&y(O=>{const D=new Map;return O.forEach(f=>D.set(f.id,f)),JSON.parse(e).connections.map(f=>{const x=D.get(f.id);return x?{...f,downloadSpeed:x.download?f.download-x.download:0,uploadSpeed:x.upload?f.upload-x.upload:0}:{...f,downloadSpeed:0,uploadSpeed:0}}).slice(-100)})});const S=e=>L.delete(`connections/${e}`),K=[{accessorKey:l.Close,enableSorting:!1,header:()=>(()=>{const e=Y();return o(e,()=>t("close")),e})(),cell:({row:e})=>(()=>{const n=We();return o(n,s(V,{class:"btn-circle btn-xs",onClick:()=>S(e.id),get children(){return s(z,{size:"18"})}})),n})()},{accessorKey:l.ID,accessorFn:e=>e.id},{accessorKey:l.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{accessorKey:l.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{accessorKey:l.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{accessorKey:l.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{accessorKey:l.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{accessorKey:l.DlSpeed,accessorFn:e=>`${k(e.downloadSpeed)}/s`,sortingFn:(e,n)=>e.original.downloadSpeed-n.original.downloadSpeed},{accessorKey:l.ULSpeed,accessorFn:e=>`${k(e.uploadSpeed)}/s`,sortingFn:(e,n)=>e.original.uploadSpeed-n.original.uploadSpeed},{accessorKey:l.Download,accessorFn:e=>k(e.download),sortingFn:(e,n)=>e.original.download-n.original.download},{accessorKey:l.Upload,accessorFn:e=>k(e.upload),sortingFn:(e,n)=>e.original.upload-n.original.upload},{accessorKey:l.Source,accessorFn:e=>ze(e.metadata.sourceIP)?`[${e.metadata.sourceIP}]:${e.metadata.sourcePort}`:`${e.metadata.sourceIP}:${e.metadata.sourcePort}`},{accessorKey:l.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}],[h,N]=E([{id:"ID",desc:!0}]),R=xe({state:{get columnOrder(){return b()},get sorting(){return h()},get columnVisibility(){return r()}},get data(){return T()?d().filter(e=>Object.values(e).some(n=>JSON.stringify(n).toLowerCase().includes(T().toLowerCase()))):d()},enableHiding:!0,columns:K,onSortingChange:N,getSortedRowModel:_e(),getCoreRowModel:ye()});return(()=>{const e=qe(),n=e.firstChild,O=n.firstChild,D=O.nextSibling,B=n.nextSibling,f=B.firstChild,x=f.firstChild,Q=x.nextSibling;return O.$$input=v=>c(v.target.value),o(n,s(V,{class:"btn-circle",onClick:()=>L.delete("connections"),get children(){return s(z,{})}}),D),o(D,s(ue,{})),o(n,s(Le,{get order(){return b()},get visible(){return r()},onOrderChange:v=>{C([...v])},onVisibleChange:v=>m({...v})}),null),o(x,s(P,{get each(){return R.getHeaderGroups()},children:v=>(()=>{const F=Je();return o(F,s(P,{get each(){return v.headers},children:u=>(()=>{const w=Ye(),I=w.firstChild;return ge(I,"click",u.column.getToggleSortingHandler(),!0),o(I,(()=>{const ee=$e(()=>u.column.id===l.Close);return()=>ee()?W(u.column.columnDef.header,u.getContext()):(()=>{const U=Y();return o(U,()=>t(u.column.id)),U})()})(),null),o(I,()=>({asc:s(me,{}),desc:s(pe,{})})[u.column.getIsSorted()]??null,null),A(()=>fe(I,be("flex items-center justify-between gap-2",u.column.getCanSort()&&"cursor-pointer select-none"))),w})()})),F})()})),o(Q,s(P,{get each(){return R.getRowModel().rows},children:v=>(()=>{const F=Ge();return o(F,s(P,{get each(){return v.getVisibleCells()},children:u=>(()=>{const w=Xe();return w.$$contextmenu=I=>{I.preventDefault(),typeof u.renderValue()=="string"&&Te(u.renderValue())},o(w,()=>W(u.column.columnDef.cell,u.getContext())),w})()})),F})()})),A(()=>he(O,"placeholder",t("search"))),e})()};ve(["input","click","contextmenu"]);export{nt as default};
