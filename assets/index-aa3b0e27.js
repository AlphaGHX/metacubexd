import{P as f}from"./vendor-bb973e4f.js";var v=(s,o,r=[])=>{const n=new WebSocket(s,o),t=n.send.bind(n);return n.send=i=>n.readyState==1?t(i):r.push(i),n.addEventListener("open",()=>{for(;r.length;)t(r.shift())}),n},m=(s,o,r={})=>{let n=r.retries||1/0,t;const i=[];let a=[["close",()=>{n-- >0&&setTimeout(l,r.delay||3e3)}]];const l=()=>{t&&t.readyState<2&&t.close(),t=Object.assign(v(s,o,i),{reconnect:l}),a.forEach(e=>t.addEventListener(...e))};l();const d={close:(...e)=>(n=0,t.close(...e)),addEventListener:(...e)=>(a.push(e),t.addEventListener(...e)),removeEventListener:(...e)=>(a=a.filter(c=>e[0]!==c[0]||e[1]!==c[1]),t.removeEventListener(...e)),send:e=>{var c,u;return(u=(c=d.send).before)==null||u.call(c),t.send(e)}};for(let e in t)d[e]==null&&Object.defineProperty(d,e,{enumerable:!0,get:()=>typeof t[e]=="function"?t[e].bind(t):t[e]});return d},p=(s,o,r)=>{const n=m(s,o,r);return f(()=>n.close()),n};export{p as c};
