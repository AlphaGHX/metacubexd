import{u as X,f as E,i as o,c as s,$ as ne,a0 as ae,a1 as se,F as T,a2 as oe,S as re,a3 as ce,b as g,a4 as le,a5 as ie,U as de,j as A,e as H,E as ue,a6 as z,G as W,d as k,C as ge,a7 as $e,h as me,a8 as pe,a9 as fe,l as be,t as he,r as ve,g as Ce}from"./vendor-a04c6957.js";import{c as Se,a as xe}from"./index-4bbd83f8.js";import{c as _e,f as q,g as ye,a as we}from"./index-16ffeba9.js";import{d as Z,f as Q,B as j,u as Ie,w as Ee,c as Oe,g as c,h as Re}from"./index-4624111a.js";const Fe=g('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),De=g('<input type="checkbox" id="connection-modal" class="modal-toggle">'),Te=g('<div class="column self-stretch">'),Pe=g('<div class="sortable">'),Ke=g('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),Le=t=>{const[r]=X(),[m,b]=E(null),C=({draggable:l})=>b(l.id),P=({draggable:l,droppable:p})=>{if(l&&p){const i=t.order,d=i.indexOf(l.id),y=i.indexOf(p.id);if(d!==y){const S=i.slice();S.splice(y,0,...S.splice(d,1)),t.onOrderChange(S)}}},K=({key:l})=>{const p=le(l),[i]=ie();return(()=>{const d=Fe(),y=d.firstChild,S=y.firstChild,L=S.nextSibling;return de(p,d,()=>!0),o(S,()=>r(l)),L.addEventListener("change",h=>{t.onVisibleChange({...t.visible,[l]:h.target.checked})}),A(h=>{const N=!!p.isActiveDraggable,O=!!i.active.draggable;return N!==h._v$&&d.classList.toggle("opacity-25",h._v$=N),O!==h._v$2&&d.classList.toggle("transition-transform",h._v$2=O),h},{_v$:void 0,_v$2:void 0}),A(()=>L.checked=t.visible[l]),d})()};return[De(),(()=>{const l=Ke(),p=l.firstChild;return o(p,s(ce,{onDragStart:C,onDragEnd:P,collisionDetector:ne,get children(){return[s(ae,{}),(()=>{const i=Te();return o(i,s(se,{get ids(){return t.order},get children(){return s(T,{get each(){return t.order},children:d=>s(K,{key:d})})}})),i})(),s(oe,{get children(){return s(re,{get when(){return m()},get children(){const i=Pe();return o(i,()=>r(m())),i}})}})]}}),null),o(p,s(j,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(Z),t.onVisibleChange(Q)},get children(){return r("reset")}}),null),l})()]};var Ne=async t=>{typeof t=="string"?await navigator.clipboard.writeText(t):await navigator.clipboard.write(t)};const G="[a-fA-F\\d:]",_=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${G})|(?<=${G})(?=\\s|$))`:"",$="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",a="[a-fA-F\\d]{1,4}",M=`
(?:
(?:${a}:){7}(?:${a}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${a}:){6}(?:${$}|:${a}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${a}:){5}(?::${$}|(?::${a}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${a}:){4}(?:(?::${a}){0,1}:${$}|(?::${a}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${a}:){3}(?:(?::${a}){0,2}:${$}|(?::${a}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${a}:){2}(?:(?::${a}){0,3}:${$}|(?::${a}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${a}:){1}(?:(?::${a}){0,4}:${$}|(?::${a}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${a}){0,5}:${$}|(?::${a}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),ke=new RegExp(`(?:^${$}$)|(?:^${M}$)`),Ae=new RegExp(`^${$}$`),Me=new RegExp(`^${M}$`),V=t=>t&&t.exact?ke:new RegExp(`(?:${_(t)}${$}${_(t)})|(?:${_(t)}${M}${_(t)})`,"g");V.v4=t=>t&&t.exact?Ae:new RegExp(`${_(t)}${$}${_(t)}`,"g");V.v6=t=>t&&t.exact?Me:new RegExp(`${_(t)}${M}${_(t)}`,"g");function je(t){const r=(...m)=>t(...m);return Object.defineProperty(r,"name",{value:`functionTimeout(${t.name||"<anonymous>"})`,configurable:!0}),r}const{toString:Ve}=Object.prototype;function Be(t){return Ve.call(t)==="[object RegExp]"}const J={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function Ue(t,r={}){if(!Be(t))throw new TypeError("Expected a RegExp instance");const m=Object.keys(J).map(C=>(typeof r[C]=="boolean"?r[C]:t[C])?J[C]:"").join(""),b=new RegExp(r.source||t.source,m);return b.lastIndex=typeof r.lastIndex=="number"?r.lastIndex:t.lastIndex,b}function He(t,r,{timeout:m}={}){try{return je(()=>Ue(t).test(r),{timeout:m})()}catch(b){throw b}}const ze=45,We={timeout:400};function qe(t){return t.length>ze?!1:He(V.v6({exact:!0}),t,We)}const Y=g("<span>"),Ge=g('<div class="flex h-full items-center">'),Je=g('<div class="flex flex-col gap-4"><div class="flex w-full items-center gap-2"><input class="input input-primary flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md"><table class="table table-xs rounded-none bg-base-200"><thead></thead><tbody>'),Ye=g("<tr>"),Xe=g('<th class="bg-base-300"><div>'),Ze=g('<tr class="hover">'),Qe=g("<td>"),st=()=>{const[t]=X(),[r,m]=H(E(Q),{name:"columnVisibility",storage:localStorage}),[b,C]=H(E(Z),{name:"columnOrder",storage:localStorage}),P=Ie(),[K,l]=E(""),p=Se(`${Ee()}/connections?token=${Oe()}`),i=xe(p,"message"),[d,y]=E([]);ue(()=>{var n;const e=(n=i())==null?void 0:n.data;e&&y(R=>{const F=new Map;return R.forEach(f=>F.set(f.id,f)),JSON.parse(e).connections.map(f=>{const x=F.get(f.id);return x?{...f,downloadSpeed:x.download?f.download-x.download:0,uploadSpeed:x.upload?f.upload-x.upload:0}:{...f,downloadSpeed:0,uploadSpeed:0}}).slice(-100)})});const S=e=>P.delete(`connections/${e}`),L=[{accessorKey:c.Close,enableSorting:!1,header:()=>(()=>{const e=Y();return o(e,()=>t("close")),e})(),cell:({row:e})=>(()=>{const n=Ge();return o(n,s(j,{class:"btn-circle btn-xs",onClick:()=>S(e.id),get children(){return s(z,{size:"18"})}})),n})()},{accessorKey:c.ID,accessorFn:e=>e.id},{accessorKey:c.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{accessorKey:c.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{accessorKey:c.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{accessorKey:c.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{accessorKey:c.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{accessorKey:c.ConnectTime,accessorFn:e=>Re(e.start),sortingFn:(e,n)=>W(e.original.start).valueOf()-W(n.original.start).valueOf()},{accessorKey:c.DlSpeed,accessorFn:e=>`${k(e.downloadSpeed)}/s`,sortingFn:(e,n)=>e.original.downloadSpeed-n.original.downloadSpeed},{accessorKey:c.ULSpeed,accessorFn:e=>`${k(e.uploadSpeed)}/s`,sortingFn:(e,n)=>e.original.uploadSpeed-n.original.uploadSpeed},{accessorKey:c.Download,accessorFn:e=>k(e.download),sortingFn:(e,n)=>e.original.download-n.original.download},{accessorKey:c.Upload,accessorFn:e=>k(e.upload),sortingFn:(e,n)=>e.original.upload-n.original.upload},{accessorKey:c.Source,accessorFn:e=>qe(e.metadata.sourceIP)?`[${e.metadata.sourceIP}]:${e.metadata.sourcePort}`:`${e.metadata.sourceIP}:${e.metadata.sourcePort}`},{accessorKey:c.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}],[h,N]=E([{id:"ID",desc:!0}]),O=_e({state:{get columnOrder(){return b()},get sorting(){return h()},get columnVisibility(){return r()}},get data(){return K()?d().filter(e=>Object.values(e).some(n=>JSON.stringify(n).toLowerCase().includes(K().toLowerCase()))):d()},enableHiding:!0,columns:L,onSortingChange:N,getSortedRowModel:ye(),getCoreRowModel:we()});return(()=>{const e=Je(),n=e.firstChild,R=n.firstChild,F=R.nextSibling,B=n.nextSibling,f=B.firstChild,x=f.firstChild,ee=x.nextSibling;return R.$$input=v=>l(v.target.value),o(n,s(j,{class:"btn-circle",onClick:()=>P.delete("connections"),get children(){return s(z,{})}}),F),o(F,s(ge,{})),o(n,s(Le,{get order(){return b()},get visible(){return r()},onOrderChange:v=>{C([...v])},onVisibleChange:v=>m({...v})}),null),o(x,s(T,{get each(){return O.getHeaderGroups()},children:v=>(()=>{const D=Ye();return o(D,s(T,{get each(){return v.headers},children:u=>(()=>{const w=Xe(),I=w.firstChild;return $e(I,"click",u.column.getToggleSortingHandler(),!0),o(I,(()=>{const te=me(()=>u.column.id===c.Close);return()=>te()?q(u.column.columnDef.header,u.getContext()):(()=>{const U=Y();return o(U,()=>t(u.column.id)),U})()})(),null),o(I,()=>({asc:s(pe,{}),desc:s(fe,{})})[u.column.getIsSorted()]??null,null),A(()=>be(I,he("flex items-center justify-between gap-2",u.column.getCanSort()&&"cursor-pointer select-none"))),w})()})),D})()})),o(ee,s(T,{get each(){return O.getRowModel().rows},children:v=>(()=>{const D=Ze();return o(D,s(T,{get each(){return v.getVisibleCells()},children:u=>(()=>{const w=Qe();return w.$$contextmenu=I=>{I.preventDefault(),typeof u.renderValue()=="string"&&Ne(u.renderValue())},o(w,()=>q(u.column.columnDef.cell,u.getContext())),w})()})),D})()})),A(()=>ve(R,"placeholder",t("search"))),e})()};Ce(["input","click","contextmenu"]);export{st as default};
