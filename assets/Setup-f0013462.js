import{u as R,e as D,o as L,L as V,i as m,f,M as j,F,n as _,d as z,k as A}from"./vendor-a821092a.js";import{c as M,v as P,z as $}from"./index-23343ee3.js";import{e as g,s as v,a as q}from"./index-2208f7ae.js";let h;const B=new Uint8Array(16);function H(){if(!h&&(h=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!h))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(B)}const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function N(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}const T=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),U={randomUUID:T};function X(t,e,r){if(U.randomUUID&&!e&&!t)return U.randomUUID();t=t||{};const s=t.random||(t.rng||H)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){r=r||0;for(let a=0;a<16;++a)e[r+a]=s[a];return e}return N(s)}const G=_('<div class="mx-auto flex flex-col items-center gap-4 py-10 sm:w-2/3"><form class="contents"><div class="flex w-full flex-col gap-4"><input name="url" type="url" class="input input-bordered" placeholder="host url" list="defaultEndpoints"><datalist id="defaultEndpoints"><option value="http://127.0.0.1:9090"></option></datalist><input name="secret" type="password" class="input input-bordered" placeholder="secret"><button type="submit" class="btn btn-primary join-item uppercase"></button></div></form><div class="flex w-full flex-col gap-4">'),J=_('<div class="badge badge-info flex w-full cursor-pointer items-center gap-4 py-4"><button class="btn btn-circle btn-ghost btn-xs text-white">'),K=$.object({url:$.string().url().nonempty(),secret:$.string()}),Y=()=>{const[t]=R(),e=D(),r=n=>{q(n),e("/overview")},s=(n,i)=>A.get(n,{headers:i?{Authorization:`Bearer ${i}`}:{}}).then(({ok:c})=>c).catch(()=>!1),a=async n=>{const i=g().find(c=>c.id===n);i&&await s(i.url,i.secret)&&r(n)},y=async({url:n,secret:i})=>{const c=g().slice(),l=c.find(d=>d.url===n);if(l){const{id:d,secret:b}=l;i!==b&&!await s(n,i)&&(l.secret=i,v(c)),r(d);return}if(!await s(n,i))return;const u=X();v([{id:u,url:n,secret:i},...c]),r(u)},{form:w}=M({extend:P({schema:K}),onSubmit:y}),E=n=>v(g().filter(i=>i.id!==n));return L(()=>{const n=new URLSearchParams(window.location.search);n.has("hostname")?y({url:`http://${n.get("hostname")}${n.get("port")&&":"+n.get("port")}`,secret:n.get("secret")??""}):y({url:"http://127.0.0.1:9090",secret:""})}),(()=>{const n=G(),i=n.firstChild,c=i.firstChild,l=c.firstChild,u=l.nextSibling,d=u.nextSibling,b=d.nextSibling,I=i.nextSibling;return V(w,i,()=>w),m(b,()=>t("add")),m(I,f(F,{get each(){return g()},children:({id:S,url:k})=>(()=>{const p=J(),x=p.firstChild;return p.$$click=()=>a(S),m(p,k,x),x.$$click=C=>{C.stopPropagation(),E(S)},m(x,f(j,{})),p})()})),n})()};z(["click"]);export{Y as default};
