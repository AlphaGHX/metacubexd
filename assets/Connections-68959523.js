import{u as de,c as h,i as a,e as o,X as Ie,Y as we,Z as Fe,F as O,_ as De,S as Ee,$ as Pe,h as u,a0 as Oe,a1 as Re,M as Te,f as R,V as Me,x as ne,a2 as oe,a as x,m as se,a3 as ae,y as re,b as z,g as T,t as M,a4 as ke,a5 as Ke,v as Ne,a6 as Y,a7 as ce,a8 as le,a9 as Ae,aa as Le,s as Ge,d as Ve}from"./vendor-cb4efd1e.js";import{c as ze}from"./index-253f8914.js";import{c as We,f as W,g as Be,a as He,b as Ue,d as je,e as qe}from"./index-2d64f093.js";import{l as ie}from"./lodash-a3a9ebf3.js";import{B}from"./Button-7c6b8c49.js";import{d as ue,f as ge,u as Ye,w as Ze,c as Xe,g as c,h as Je,t as Qe,i as et}from"./index-5e97ec7d.js";const tt=u('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),nt=u('<input type="checkbox" id="connection-modal" class="modal-toggle">'),ot=u('<div class="column self-stretch">'),st=u('<div class="sortable">'),at=u('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),rt=t=>{const[F]=de(),[K,N]=h(null),A=({draggable:d})=>N(d.id),H=({draggable:d,droppable:$})=>{if(d&&$){const g=t.order,m=g.indexOf(d.id),D=g.indexOf($.id);if(m!==D){const v=g.slice();v.splice(D,0,...v.splice(m,1)),t.onOrderChange(v)}}},U=({key:d})=>{const $=Oe(d),[g]=Re();return(()=>{const m=tt(),D=m.firstChild,v=D.firstChild,L=v.nextSibling;return Te($,m,()=>!0),a(v,()=>F(d)),L.addEventListener("change",f=>{t.onVisibleChange({...t.visible,[d]:f.target.checked})}),R(f=>{const G=!!$.isActiveDraggable,V=!!g.active.draggable;return G!==f._v$&&m.classList.toggle("opacity-25",f._v$=G),V!==f._v$2&&m.classList.toggle("transition-transform",f._v$2=V),f},{_v$:void 0,_v$2:void 0}),R(()=>L.checked=t.visible[d]),m})()};return[nt(),(()=>{const d=at(),$=d.firstChild;return a($,o(Pe,{onDragStart:A,onDragEnd:H,collisionDetector:Ie,get children(){return[o(we,{}),(()=>{const g=ot();return a(g,o(Fe,{get ids(){return t.order},get children(){return o(O,{get each(){return t.order},children:m=>o(U,{key:m})})}})),g})(),o(De,{get children(){return o(Ee,{get when(){return K()},get children(){const g=st();return a(g,()=>F(K())),g}})}})]}}),null),a($,o(B,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(ue),t.onVisibleChange(ge)},get children(){return F("reset")}}),null),d})()]};var ct=async t=>{typeof t=="string"?await navigator.clipboard.writeText(t):await navigator.clipboard.write(t)};const lt=u('<div class="flex h-4 items-center">'),it=u('<div class="flex h-full flex-col gap-4 overflow-y-auto p-1"><div class="tabs-boxed tabs gap-2"></div><div class="flex w-full flex-wrap items-center gap-2"><input class="input input-primary flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),dt=u("<button> (<!>)"),ut=u("<tr>"),gt=u('<th class="bg-base-200"><div><div>'),mt=u('<button class="cursor-pointer">'),pt=u('<tr class="h-8 hover:!bg-primary hover:text-primary-content">'),ht=u("<td>"),$t=u("<button><div></div><div></div><div>(<!>)");var k=function(t){return t.activeConnections="activeConnections",t.closedConnections="closedConnections",t}(k||{});const xt=()=>{const[t]=de(),F=Ye(),[K,N]=h(""),[A,H]=h(k.activeConnections),U=ze(`${Ze()}/connections?token=${Xe()}`),d=Me(U,"message"),[$,g]=h([]),[m,D]=h([]),[v,L]=h(!1),[f,G]=h([]),[V,me]=h([]);ne(()=>{var r;const e=(r=d())==null?void 0:r.data;e&&D(y=>{const E=new Map;y.forEach(l=>E.set(l.id,l));const P=JSON.parse(e).connections.map(l=>{const b=E.get(l.id);return b?{...l,downloadSpeed:b.download?l.download-b.download:0,uploadSpeed:b.upload?l.upload-b.upload:0}:{...l,downloadSpeed:0,uploadSpeed:0}}),j=ie.differenceWith(y,P,(l,b)=>ie.isEqualWith(l,b,(q,n)=>q.id===n.id));return g(l=>[...l,...j].slice(-100)),P.slice(-100)})}),ne(()=>{v()&&(G(oe(()=>m())),me(oe(()=>$())))});const Z=x(()=>v()?f():m()),X=x(()=>v()?V():$()),pe=e=>F.delete(`connections/${e}`),[J,he]=se(h(ge),{name:"columnVisibility",storage:localStorage}),[Q,$e]=se(h(ue),{name:"columnOrder",storage:localStorage}),ve=[{header:()=>t("close"),enableGrouping:!1,enableSorting:!1,accessorKey:c.Close,cell:({row:e})=>(()=>{const r=lt();return a(r,o(B,{class:"btn-circle btn-xs",onClick:()=>pe(e.id),get children(){return o(ae,{size:"16"})}})),r})()},{header:()=>t("ID"),enableGrouping:!1,accessorKey:c.ID,accessorFn:e=>e.id},{header:()=>t("type"),accessorKey:c.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{header:()=>t("process"),accessorKey:c.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>t("host"),accessorKey:c.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{header:()=>t("rules"),accessorKey:c.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{header:()=>t("chains"),accessorKey:c.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{header:()=>t("connectTime"),accessorKey:c.ConnectTime,accessorFn:e=>Je(e.start),sortingFn:(e,r)=>re(e.original.start).valueOf()-re(r.original.start).valueOf()},{header:()=>t("dlSpeed"),accessorKey:c.DlSpeed,accessorFn:e=>`${z(e.downloadSpeed)}/s`,sortingFn:(e,r)=>e.original.downloadSpeed-r.original.downloadSpeed},{header:()=>t("ulSpeed"),accessorKey:c.ULSpeed,accessorFn:e=>`${z(e.uploadSpeed)}/s`,sortingFn:(e,r)=>e.original.uploadSpeed-r.original.uploadSpeed},{header:()=>t("dl"),accessorKey:c.Download,accessorFn:e=>z(e.download),sortingFn:(e,r)=>e.original.download-r.original.download},{header:()=>t("ul"),accessorKey:c.Upload,accessorFn:e=>z(e.upload),sortingFn:(e,r)=>e.original.upload-r.original.upload},{header:()=>t("sourceIP"),accessorKey:c.SourceIP,accessorFn:e=>e.metadata.sourceIP},{header:()=>t("sourcePort"),accessorKey:c.SourcePort,accessorFn:e=>e.metadata.sourcePort},{header:()=>t("destination"),accessorKey:c.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}],[Ce,be]=h([]),[fe,_e]=h([{id:c.ConnectTime,desc:!0}]),ee=We({state:{get columnOrder(){return Q()},get grouping(){return Ce()},get sorting(){return fe()},get columnVisibility(){return J()},get globalFilter(){return K()}},get data(){return A()===k.activeConnections?Z():X()},sortDescFirst:!0,enableHiding:!0,columns:ve,onGlobalFilterChange:N,onGroupingChange:be,onSortingChange:_e,getFilteredRowModel:Be(),getSortedRowModel:He(),getExpandedRowModel:Ue(),getGroupedRowModel:je(),getCoreRowModel:qe()}),Se=()=>[{type:k.activeConnections,name:t("activeConnections"),count:Z().length},{type:k.closedConnections,name:t("closedConnections"),count:X().length}];return(()=>{const e=it(),r=e.firstChild,y=r.nextSibling,E=y.firstChild,P=E.nextSibling,j=y.nextSibling,l=j.firstChild,b=l.firstChild,q=b.nextSibling;return a(r,o(O,{get each(){return Se()},children:n=>(()=>{const i=dt(),s=i.firstChild,_=s.nextSibling;return _.nextSibling,i.$$click=()=>H(n.type),a(i,()=>n.name,s),a(i,()=>n.count,_),R(()=>T(i,M(A()===n.type&&"tab-active","tab"))),i})()})),E.$$input=n=>N(n.target.value),a(y,o(B,{class:"btn-circle",onClick:()=>L(n=>!n),get children(){return x(()=>!!v())()?o(ke,{}):o(Ke,{})}}),P),a(y,o(B,{class:"btn-circle",onClick:()=>F.delete("connections"),get children(){return o(ae,{})}}),P),a(P,o(Ne,{})),a(y,o(rt,{get order(){return Q()},get visible(){return J()},onOrderChange:n=>{$e([...n])},onVisibleChange:n=>he({...n})}),null),a(b,o(O,{get each(){return ee.getHeaderGroups()},children:n=>(()=>{const i=ut();return a(i,o(O,{get each(){return n.headers},children:s=>(()=>{const _=gt(),I=_.firstChild,C=I.firstChild;return a(I,(()=>{const p=x(()=>!!s.column.getCanGroup());return()=>p()?(()=>{const S=mt();return Y(S,"click",s.column.getToggleGroupingHandler(),!0),a(S,(()=>{const w=x(()=>!!s.column.getIsGrouped());return()=>w()?o(ce,{size:18}):o(le,{size:18})})()),S})():null})(),C),Y(C,"click",s.column.getToggleSortingHandler(),!0),a(C,()=>W(s.column.columnDef.header,s.getContext())),a(I,()=>({asc:o(Ae,{}),desc:o(Le,{})})[s.column.getIsSorted()]??null,null),R(p=>{const S=M("flex items-center gap-2"),w=M(s.column.getCanSort()&&"cursor-pointer select-none","flex-1");return S!==p._v$3&&T(I,p._v$3=S),w!==p._v$4&&T(C,p._v$4=w),p},{_v$3:void 0,_v$4:void 0}),_})()})),i})()})),a(q,o(O,{get each(){return ee.getRowModel().rows},children:n=>(()=>{const i=pt();return a(i,o(O,{get each(){return n.getVisibleCells()},children:s=>(()=>{const _=ht();return _.$$contextmenu=I=>{I.preventDefault(),typeof s.renderValue()=="string"&&ct(s.renderValue())},a(_,(()=>{const I=x(()=>!!s.getIsGrouped());return()=>I()?(()=>{const C=$t(),p=C.firstChild,S=p.nextSibling,w=S.nextSibling,xe=w.firstChild,te=xe.nextSibling;return te.nextSibling,Y(C,"click",n.getToggleExpandedHandler(),!0),a(p,(()=>{const ye=x(()=>!!n.getIsExpanded());return()=>ye()?o(ce,{size:18}):o(le,{size:18})})()),a(S,()=>W(s.column.columnDef.cell,s.getContext())),a(w,()=>n.subRows.length,te),R(()=>T(C,M(n.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),C})():(()=>{const C=x(()=>!!s.getIsAggregated());return()=>C()?W(s.column.columnDef.aggregatedCell??s.column.columnDef.cell,s.getContext()):(()=>{const p=x(()=>!!s.getIsPlaceholder());return()=>p()?null:W(s.column.columnDef.cell,s.getContext())})()})()})()),_})()})),i})()})),R(n=>{const i=t("search"),s=M(Qe(et()),"table table-zebra relative rounded-none");return i!==n._v$&&Ge(E,"placeholder",n._v$=i),s!==n._v$2&&T(l,n._v$2=s),n},{_v$:void 0,_v$2:void 0}),e})()};Ve(["input","click","contextmenu"]);export{xt as default};
