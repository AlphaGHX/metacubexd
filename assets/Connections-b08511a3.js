import{u as X,f as E,i as o,c as s,a0 as ne,a1 as ae,a2 as se,F as T,a3 as oe,S as re,a4 as ce,b as g,a5 as le,a6 as ie,U as de,j as k,e as z,_ as ue,E as ge,a7 as H,G,d as N,C as $e,a8 as me,h as pe,a9 as be,aa as fe,l as he,t as ve,r as Ce,g as xe}from"./vendor-a313f5e6.js";import{c as Se}from"./index-167ace07.js";import{c as _e,f as W,g as ye,a as we,b as Ie}from"./index-82f7b786.js";import{d as Z,f as Q,B as V,u as Ee,w as Re,c as Fe,g as l,h as Oe}from"./index-f24519d7.js";const De=g('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),Te=g('<input type="checkbox" id="connection-modal" class="modal-toggle">'),Pe=g('<div class="column self-stretch">'),Ke=g('<div class="sortable">'),Me=g('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),Ne=t=>{const[r]=X(),[m,f]=E(null),C=({draggable:c})=>f(c.id),P=({draggable:c,droppable:p})=>{if(c&&p){const i=t.order,d=i.indexOf(c.id),y=i.indexOf(p.id);if(d!==y){const x=i.slice();x.splice(y,0,...x.splice(d,1)),t.onOrderChange(x)}}},A=({key:c})=>{const p=le(c),[i]=ie();return(()=>{const d=De(),y=d.firstChild,x=y.firstChild,K=x.nextSibling;return de(p,d,()=>!0),o(x,()=>r(c)),K.addEventListener("change",h=>{t.onVisibleChange({...t.visible,[c]:h.target.checked})}),k(h=>{const M=!!p.isActiveDraggable,R=!!i.active.draggable;return M!==h._v$&&d.classList.toggle("opacity-25",h._v$=M),R!==h._v$2&&d.classList.toggle("transition-transform",h._v$2=R),h},{_v$:void 0,_v$2:void 0}),k(()=>K.checked=t.visible[c]),d})()};return[Te(),(()=>{const c=Me(),p=c.firstChild;return o(p,s(ce,{onDragStart:C,onDragEnd:P,collisionDetector:ne,get children(){return[s(ae,{}),(()=>{const i=Pe();return o(i,s(se,{get ids(){return t.order},get children(){return s(T,{get each(){return t.order},children:d=>s(A,{key:d})})}})),i})(),s(oe,{get children(){return s(re,{get when(){return m()},get children(){const i=Ke();return o(i,()=>r(m())),i}})}})]}}),null),o(p,s(V,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(Z),t.onVisibleChange(Q)},get children(){return r("reset")}}),null),c})()]};var ke=async t=>{typeof t=="string"?await navigator.clipboard.writeText(t):await navigator.clipboard.write(t)};const q="[a-fA-F\\d:]",_=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${q})|(?<=${q})(?=\\s|$))`:"",$="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",a="[a-fA-F\\d]{1,4}",L=`
(?:
(?:${a}:){7}(?:${a}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${a}:){6}(?:${$}|:${a}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${a}:){5}(?::${$}|(?::${a}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${a}:){4}(?:(?::${a}){0,1}:${$}|(?::${a}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${a}:){3}(?:(?::${a}){0,2}:${$}|(?::${a}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${a}:){2}(?:(?::${a}){0,3}:${$}|(?::${a}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${a}:){1}(?:(?::${a}){0,4}:${$}|(?::${a}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${a}){0,5}:${$}|(?::${a}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Le=new RegExp(`(?:^${$}$)|(?:^${L}$)`),Ae=new RegExp(`^${$}$`),Ve=new RegExp(`^${L}$`),j=t=>t&&t.exact?Le:new RegExp(`(?:${_(t)}${$}${_(t)})|(?:${_(t)}${L}${_(t)})`,"g");j.v4=t=>t&&t.exact?Ae:new RegExp(`${_(t)}${$}${_(t)}`,"g");j.v6=t=>t&&t.exact?Ve:new RegExp(`${_(t)}${L}${_(t)}`,"g");function je(t){const r=(...m)=>t(...m);return Object.defineProperty(r,"name",{value:`functionTimeout(${t.name||"<anonymous>"})`,configurable:!0}),r}const{toString:Be}=Object.prototype;function Ue(t){return Be.call(t)==="[object RegExp]"}const Y={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function ze(t,r={}){if(!Ue(t))throw new TypeError("Expected a RegExp instance");const m=Object.keys(Y).map(C=>(typeof r[C]=="boolean"?r[C]:t[C])?Y[C]:"").join(""),f=new RegExp(r.source||t.source,m);return f.lastIndex=typeof r.lastIndex=="number"?r.lastIndex:t.lastIndex,f}function He(t,r,{timeout:m}={}){try{return je(()=>ze(t).test(r),{timeout:m})()}catch(f){throw f}}const Ge=45,We={timeout:400};function qe(t){return t.length>Ge?!1:He(j.v6({exact:!0}),t,We)}const J=g("<span>"),Ye=g('<div class="flex h-4 items-center">'),Je=g('<div class="flex h-full flex-col gap-4 overflow-y-auto p-1"><div class="flex w-full items-center gap-2"><input class="input input-primary flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table class="table table-zebra table-xs relative rounded-none"><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),Xe=g("<tr>"),Ze=g('<th class="bg-base-200"><div>'),Qe=g('<tr class="h-8 hover:!bg-primary hover:text-primary-content">'),et=g("<td>"),ot=()=>{const[t]=X(),[r,m]=z(E(Q),{name:"columnVisibility",storage:localStorage}),[f,C]=z(E(Z),{name:"columnOrder",storage:localStorage}),P=Ee(),[A,c]=E(""),p=Se(`${Re()}/connections?token=${Fe()}`),i=ue(p,"message"),[d,y]=E([]);ge(()=>{var n;const e=(n=i())==null?void 0:n.data;e&&y(F=>{const O=new Map;return F.forEach(b=>O.set(b.id,b)),JSON.parse(e).connections.map(b=>{const S=O.get(b.id);return S?{...b,downloadSpeed:S.download?b.download-S.download:0,uploadSpeed:S.upload?b.upload-S.upload:0}:{...b,downloadSpeed:0,uploadSpeed:0}}).slice(-100)})});const x=e=>P.delete(`connections/${e}`),K=[{accessorKey:l.Close,enableSorting:!1,header:()=>(()=>{const e=J();return o(e,()=>t("close")),e})(),cell:({row:e})=>(()=>{const n=Ye();return o(n,s(V,{class:"btn-circle btn-xs",onClick:()=>x(e.id),get children(){return s(H,{size:"16"})}})),n})()},{accessorKey:l.ID,accessorFn:e=>e.id},{accessorKey:l.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{accessorKey:l.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{accessorKey:l.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{accessorKey:l.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{accessorKey:l.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{accessorKey:l.ConnectTime,accessorFn:e=>Oe(e.start),sortingFn:(e,n)=>G(e.original.start).valueOf()-G(n.original.start).valueOf()},{accessorKey:l.DlSpeed,accessorFn:e=>`${N(e.downloadSpeed)}/s`,sortingFn:(e,n)=>e.original.downloadSpeed-n.original.downloadSpeed},{accessorKey:l.ULSpeed,accessorFn:e=>`${N(e.uploadSpeed)}/s`,sortingFn:(e,n)=>e.original.uploadSpeed-n.original.uploadSpeed},{accessorKey:l.Download,accessorFn:e=>N(e.download),sortingFn:(e,n)=>e.original.download-n.original.download},{accessorKey:l.Upload,accessorFn:e=>N(e.upload),sortingFn:(e,n)=>e.original.upload-n.original.upload},{accessorKey:l.Source,accessorFn:e=>qe(e.metadata.sourceIP)?`[${e.metadata.sourceIP}]:${e.metadata.sourcePort}`:`${e.metadata.sourceIP}:${e.metadata.sourcePort}`},{accessorKey:l.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}],[h,M]=E([{id:"ID",desc:!0}]),R=_e({state:{get columnOrder(){return f()},get sorting(){return h()},get columnVisibility(){return r()},get globalFilter(){return A()}},get data(){return d()},enableHiding:!0,columns:K,onGlobalFilterChange:c,getFilteredRowModel:ye(),onSortingChange:M,getSortedRowModel:we(),getCoreRowModel:Ie()});return(()=>{const e=Je(),n=e.firstChild,F=n.firstChild,O=F.nextSibling,B=n.nextSibling,b=B.firstChild,S=b.firstChild,ee=S.nextSibling;return F.$$input=v=>c(v.target.value),o(n,s(V,{class:"btn-circle",onClick:()=>P.delete("connections"),get children(){return s(H,{})}}),O),o(O,s($e,{})),o(n,s(Ne,{get order(){return f()},get visible(){return r()},onOrderChange:v=>{C([...v])},onVisibleChange:v=>m({...v})}),null),o(S,s(T,{get each(){return R.getHeaderGroups()},children:v=>(()=>{const D=Xe();return o(D,s(T,{get each(){return v.headers},children:u=>(()=>{const w=Ze(),I=w.firstChild;return me(I,"click",u.column.getToggleSortingHandler(),!0),o(I,(()=>{const te=pe(()=>u.column.id===l.Close);return()=>te()?W(u.column.columnDef.header,u.getContext()):(()=>{const U=J();return o(U,()=>t(u.column.id)),U})()})(),null),o(I,()=>({asc:s(be,{}),desc:s(fe,{})})[u.column.getIsSorted()]??null,null),k(()=>he(I,ve("flex items-center justify-between gap-2",u.column.getCanSort()&&"cursor-pointer select-none"))),w})()})),D})()})),o(ee,s(T,{get each(){return R.getRowModel().rows},children:v=>(()=>{const D=Qe();return o(D,s(T,{get each(){return v.getVisibleCells()},children:u=>(()=>{const w=et();return w.$$contextmenu=I=>{I.preventDefault(),typeof u.renderValue()=="string"&&ke(u.renderValue())},o(w,()=>W(u.column.columnDef.cell,u.getContext())),w})()})),D})()})),k(()=>Ce(F,"placeholder",t("search"))),e})()};xe(["input","click","contextmenu"]);export{ot as default};
