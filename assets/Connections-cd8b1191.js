import{u as ge,c as E,i as r,e as a,X as ye,Y as Ie,Z as we,F as P,_ as Ee,S as Re,$ as Fe,h as $,a0 as De,a1 as Oe,M as Te,f as A,V as Me,x as ke,m as ae,a2 as oe,y as re,b as B,g as z,t as V,v as Ne,a as N,a3 as Q,a4 as ce,a5 as le,a6 as Pe,a7 as Ae,s as Ke,d as Le}from"./vendor-bb973e4f.js";import{c as Ge}from"./index-aa3b0e27.js";import{c as ze,f as H,g as Ve,a as je,b as We,d as Be,e as He}from"./index-ce0d7588.js";import{l as ie}from"./lodash-ded917b8.js";import{B as ee}from"./Button-f3342b78.js";import{d as $e,f as me,u as Ue,w as Ze,c as qe,g as u,h as Xe,t as Ye,T as U}from"./index-0f2c0f33.js";const Je=$('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),Qe=$('<input type="checkbox" id="connection-modal" class="modal-toggle">'),et=$('<div class="column self-stretch">'),tt=$('<div class="sortable">'),nt=$('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),st=e=>{const[l]=ge(),[C,x]=E(null),S=({draggable:g})=>x(g.id),q=({draggable:g,droppable:b})=>{if(g&&b){const m=e.order,p=m.indexOf(g.id),M=m.indexOf(b.id);if(p!==M){const R=m.slice();R.splice(M,0,...R.splice(p,1)),e.onOrderChange(R)}}},X=({key:g})=>{const b=De(g),[m]=Oe();return(()=>{const p=Je(),M=p.firstChild,R=M.firstChild,K=R.nextSibling;return Te(b,p,()=>!0),r(R,()=>l(g)),K.addEventListener("change",y=>{e.onVisibleChange({...e.visible,[g]:y.target.checked})}),A(y=>{const L=!!b.isActiveDraggable,W=!!m.active.draggable;return L!==y._v$&&p.classList.toggle("opacity-25",y._v$=L),W!==y._v$2&&p.classList.toggle("transition-transform",y._v$2=W),y},{_v$:void 0,_v$2:void 0}),A(()=>K.checked=e.visible[g]),p})()};return[Qe(),(()=>{const g=nt(),b=g.firstChild;return r(b,a(Fe,{onDragStart:S,onDragEnd:q,collisionDetector:ye,get children(){return[a(Ie,{}),(()=>{const m=et();return r(m,a(we,{get ids(){return e.order},get children(){return a(P,{get each(){return e.order},children:p=>a(X,{key:p})})}})),m})(),a(Ee,{get children(){return a(Re,{get when(){return C()},get children(){const m=tt();return r(m,()=>l(C())),m}})}})]}}),null),r(b,a(ee,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{e.onOrderChange($e),e.onVisibleChange(me)},get children(){return l("reset")}}),null),g})()]};var at=async e=>{typeof e=="string"?await navigator.clipboard.writeText(e):await navigator.clipboard.write(e)};const de="[a-fA-F\\d:]",D=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${de})|(?<=${de})(?=\\s|$))`:"",f="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",c="[a-fA-F\\d]{1,4}",Z=`
(?:
(?:${c}:){7}(?:${c}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${c}:){6}(?:${f}|:${c}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${c}:){5}(?::${f}|(?::${c}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${c}:){4}(?:(?::${c}){0,1}:${f}|(?::${c}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${c}:){3}(?:(?::${c}){0,2}:${f}|(?::${c}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${c}:){2}(?:(?::${c}){0,3}:${f}|(?::${c}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${c}:){1}(?:(?::${c}){0,4}:${f}|(?::${c}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${c}){0,5}:${f}|(?::${c}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),ot=new RegExp(`(?:^${f}$)|(?:^${Z}$)`),rt=new RegExp(`^${f}$`),ct=new RegExp(`^${Z}$`),te=e=>e&&e.exact?ot:new RegExp(`(?:${D(e)}${f}${D(e)})|(?:${D(e)}${Z}${D(e)})`,"g");te.v4=e=>e&&e.exact?rt:new RegExp(`${D(e)}${f}${D(e)}`,"g");te.v6=e=>e&&e.exact?ct:new RegExp(`${D(e)}${Z}${D(e)}`,"g");function lt(e){const l=(...C)=>e(...C);return Object.defineProperty(l,"name",{value:`functionTimeout(${e.name||"<anonymous>"})`,configurable:!0}),l}const{toString:it}=Object.prototype;function dt(e){return it.call(e)==="[object RegExp]"}const ue={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function ut(e,l={}){if(!dt(e))throw new TypeError("Expected a RegExp instance");const C=Object.keys(ue).map(S=>(typeof l[S]=="boolean"?l[S]:e[S])?ue[S]:"").join(""),x=new RegExp(l.source||e.source,C);return x.lastIndex=typeof l.lastIndex=="number"?l.lastIndex:e.lastIndex,x}function gt(e,l,{timeout:C}={}){try{return lt(()=>ut(e).test(l),{timeout:C})()}catch(x){throw x}}const $t=45,mt={timeout:400};function pt(e){return e.length>$t?!1:gt(te.v6({exact:!0}),e,mt)}const ht=$('<div class="flex h-4 items-center">'),bt=$('<div class="flex h-full flex-col gap-4 overflow-y-auto p-1"><div class="tabs-boxed tabs"></div><div class="flex w-full items-center gap-2"><input class="input input-primary flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),vt=$("<button> (<!>)"),ft=$("<tr>"),Ct=$('<th class="bg-base-200"><div><div>'),_t=$('<button class="cursor-pointer">'),xt=$('<tr class="h-8 hover:!bg-primary hover:text-primary-content">'),St=$("<td>"),yt=$("<button><div></div><div></div><div>(<!>)");var j=function(e){return e.activeConnections="activeConnections",e.closedConnections="closedConnections",e}(j||{});const Ot=()=>{const[e]=ge(),l=Ue(),[C,x]=E(""),[S,q]=E(j.activeConnections),X=Ge(`${Ze()}/connections?token=${qe()}`),g=Me(X,"message"),[b,m]=E([]),[p,M]=E([]);ke(()=>{var o;const t=(o=g())==null?void 0:o.data;t&&M(O=>{const k=new Map;O.forEach(i=>k.set(i.id,i));const G=JSON.parse(t).connections.map(i=>{const _=k.get(i.id);return _?{...i,downloadSpeed:_.download?i.download-_.download:0,uploadSpeed:_.upload?i.upload-_.upload:0}:{...i,downloadSpeed:0,uploadSpeed:0}}),Y=ie.differenceWith(O,G,(i,_)=>ie.isEqualWith(i,_,(J,s)=>J.id===s.id));return m(i=>[...i,...Y].slice(-1e3)),G.slice(-100)})});const R=t=>l.delete(`connections/${t}`),[K,y]=ae(E(me),{name:"columnVisibility",storage:localStorage}),[L,W]=ae(E($e),{name:"columnOrder",storage:localStorage}),pe=[{header:()=>e("close"),enableGrouping:!1,enableSorting:!1,accessorKey:u.Close,cell:({row:t})=>(()=>{const o=ht();return r(o,a(ee,{class:"btn-circle btn-xs",onClick:()=>R(t.id),get children(){return a(oe,{size:"16"})}})),o})()},{header:()=>e("ID"),enableGrouping:!1,accessorKey:u.ID,accessorFn:t=>t.id},{header:()=>e("type"),accessorKey:u.Type,accessorFn:t=>`${t.metadata.type}(${t.metadata.network})`},{header:()=>e("process"),accessorKey:u.Process,accessorFn:t=>t.metadata.process||t.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>e("host"),accessorKey:u.Host,accessorFn:t=>`${t.metadata.host?t.metadata.host:t.metadata.destinationIP}:${t.metadata.destinationPort}`},{header:()=>e("rules"),accessorKey:u.Rule,accessorFn:t=>t.rulePayload?`${t.rule} :: ${t.rulePayload}`:t.rule},{header:()=>e("chains"),accessorKey:u.Chains,accessorFn:t=>t.chains.slice().reverse().join(" :: ")},{header:()=>e("connectTime"),accessorKey:u.ConnectTime,accessorFn:t=>Xe(t.start),sortingFn:(t,o)=>re(t.original.start).valueOf()-re(o.original.start).valueOf()},{header:()=>e("dlSpeed"),accessorKey:u.DlSpeed,accessorFn:t=>`${B(t.downloadSpeed)}/s`,sortingFn:(t,o)=>t.original.downloadSpeed-o.original.downloadSpeed},{header:()=>e("ulSpeed"),accessorKey:u.ULSpeed,accessorFn:t=>`${B(t.uploadSpeed)}/s`,sortingFn:(t,o)=>t.original.uploadSpeed-o.original.uploadSpeed},{header:()=>e("dl"),accessorKey:u.Download,accessorFn:t=>B(t.download),sortingFn:(t,o)=>t.original.download-o.original.download},{header:()=>e("ul"),accessorKey:u.Upload,accessorFn:t=>B(t.upload),sortingFn:(t,o)=>t.original.upload-o.original.upload},{header:()=>e("source"),accessorKey:u.Source,accessorFn:t=>pt(t.metadata.sourceIP)?`[${t.metadata.sourceIP}]:${t.metadata.sourcePort}`:`${t.metadata.sourceIP}:${t.metadata.sourcePort}`},{header:()=>e("destination"),accessorKey:u.Destination,accessorFn:t=>t.metadata.remoteDestination||t.metadata.destinationIP||t.metadata.host}],[he,be]=E([]),[ve,fe]=E([{id:u.ConnectTime,desc:!0}]),ne=ze({state:{get columnOrder(){return L()},get grouping(){return he()},get sorting(){return ve()},get columnVisibility(){return K()},get globalFilter(){return C()}},get data(){return S()===j.activeConnections?p():b()},sortDescFirst:!0,enableHiding:!0,columns:pe,onGlobalFilterChange:x,onGroupingChange:be,onSortingChange:fe,getFilteredRowModel:Ve(),getSortedRowModel:je(),getExpandedRowModel:We(),getGroupedRowModel:Be(),getCoreRowModel:He()}),Ce=()=>{const t=Ye();let o="table-xs";switch(t){case U.XS:o="table-xs";break;case U.SM:o="table-sm";break;case U.MD:o="table-md";break;case U.LG:o="table-lg";break}return o},_e=()=>[{type:j.activeConnections,name:e("activeConnections"),count:p().length},{type:j.closedConnections,name:e("closedConnections"),count:b().length}];return(()=>{const t=bt(),o=t.firstChild,O=o.nextSibling,k=O.firstChild,G=k.nextSibling,Y=O.nextSibling,i=Y.firstChild,_=i.firstChild,J=_.nextSibling;return r(o,a(P,{get each(){return _e()},children:s=>(()=>{const d=vt(),n=d.firstChild,I=n.nextSibling;return I.nextSibling,d.$$click=()=>q(s.type),r(d,()=>s.name,n),r(d,()=>s.count,I),A(()=>z(d,V(S()===s.type&&"tab-active","tab"))),d})()})),k.$$input=s=>x(s.target.value),r(O,a(ee,{class:"btn-circle",onClick:()=>l.delete("connections"),get children(){return a(oe,{})}}),G),r(G,a(Ne,{})),r(O,a(st,{get order(){return L()},get visible(){return K()},onOrderChange:s=>{W([...s])},onVisibleChange:s=>y({...s})}),null),r(_,a(P,{get each(){return ne.getHeaderGroups()},children:s=>(()=>{const d=ft();return r(d,a(P,{get each(){return s.headers},children:n=>(()=>{const I=Ct(),F=I.firstChild,v=F.firstChild;return r(F,(()=>{const h=N(()=>!!n.column.getCanGroup());return()=>h()?(()=>{const w=_t();return Q(w,"click",n.column.getToggleGroupingHandler(),!0),r(w,(()=>{const T=N(()=>!!n.column.getIsGrouped());return()=>T()?a(ce,{size:18}):a(le,{size:18})})()),w})():null})(),v),Q(v,"click",n.column.getToggleSortingHandler(),!0),r(v,()=>H(n.column.columnDef.header,n.getContext())),r(F,()=>({asc:a(Pe,{}),desc:a(Ae,{})})[n.column.getIsSorted()]??null,null),A(h=>{const w=V("flex items-center gap-2"),T=V(n.column.getCanSort()&&"cursor-pointer select-none","flex-1");return w!==h._v$3&&z(F,h._v$3=w),T!==h._v$4&&z(v,h._v$4=T),h},{_v$3:void 0,_v$4:void 0}),I})()})),d})()})),r(J,a(P,{get each(){return ne.getRowModel().rows},children:s=>(()=>{const d=xt();return r(d,a(P,{get each(){return s.getVisibleCells()},children:n=>(()=>{const I=St();return I.$$contextmenu=F=>{F.preventDefault(),typeof n.renderValue()=="string"&&at(n.renderValue())},r(I,(()=>{const F=N(()=>!!n.getIsGrouped());return()=>F()?(()=>{const v=yt(),h=v.firstChild,w=h.nextSibling,T=w.nextSibling,xe=T.firstChild,se=xe.nextSibling;return se.nextSibling,Q(v,"click",s.getToggleExpandedHandler(),!0),r(h,(()=>{const Se=N(()=>!!s.getIsExpanded());return()=>Se()?a(ce,{size:18}):a(le,{size:18})})()),r(w,()=>H(n.column.columnDef.cell,n.getContext())),r(T,()=>s.subRows.length,se),A(()=>z(v,V(s.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),v})():(()=>{const v=N(()=>!!n.getIsAggregated());return()=>v()?H(n.column.columnDef.aggregatedCell??n.column.columnDef.cell,n.getContext()):(()=>{const h=N(()=>!!n.getIsPlaceholder());return()=>h()?null:H(n.column.columnDef.cell,n.getContext())})()})()})()),I})()})),d})()})),A(s=>{const d=e("search"),n=V(Ce(),"table table-zebra relative rounded-none");return d!==s._v$&&Ke(k,"placeholder",s._v$=d),n!==s._v$2&&z(i,s._v$2=n),s},{_v$:void 0,_v$2:void 0}),t})()};Le(["input","click","contextmenu"]);export{Ot as default};
