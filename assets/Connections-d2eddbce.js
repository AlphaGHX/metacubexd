import{u as oe,c as $,i as a,g as n,X as $e,Y as fe,Z as ve,F as E,_ as Ce,S as _e,$ as Se,l as u,a0 as xe,a1 as ye,O as Ie,h as P,y as we,m as Q,e as C,a2 as ee,z as te,b as V,j as K,t as M,a3 as Fe,a4 as De,x as Oe,a5 as j,a6 as ne,a7 as se,a8 as Ee,a9 as Pe,s as Re,f as Te}from"./vendor-9d884d62.js";import{c as Ke,g as Me,a as Ge,b as ke,d as Ne,e as Le,f as W}from"./index-5044fb0a.js";import{l as Ae}from"./lodash-213f5a5f.js";import{B}from"./Button-2f123a88.js";import{c as ae,d as re,f as ze,u as Ve,g as c,h as We,t as Be,i as He}from"./index-1125ab09.js";const qe=u('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),je=u('<input type="checkbox" id="connection-modal" class="modal-toggle">'),Ue=u('<div class="column self-stretch">'),Ye=u('<div class="sortable">'),Ze=u('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),Xe=t=>{const[D]=oe(),[k,N]=$(null),L=({draggable:i})=>N(i.id),H=({draggable:i,droppable:b})=>{if(i&&b){const d=t.order,m=d.indexOf(i.id),_=d.indexOf(b.id);if(m!==_){const S=d.slice();S.splice(_,0,...S.splice(m,1)),t.onOrderChange(S)}}},q=({key:i})=>{const b=xe(i),[d]=ye();return(()=>{const m=qe(),_=m.firstChild,S=_.firstChild,A=S.nextSibling;return Ie(b,m,()=>!0),a(S,()=>D(i)),A.addEventListener("change",f=>{t.onVisibleChange({...t.visible,[i]:f.target.checked})}),P(f=>{const R=!!b.isActiveDraggable,z=!!d.active.draggable;return R!==f._v$&&m.classList.toggle("opacity-25",f._v$=R),z!==f._v$2&&m.classList.toggle("transition-transform",f._v$2=z),f},{_v$:void 0,_v$2:void 0}),P(()=>A.checked=t.visible[i]),m})()};return[je(),(()=>{const i=Ze(),b=i.firstChild;return a(b,n(Se,{onDragStart:L,onDragEnd:H,collisionDetector:$e,get children(){return[n(fe,{}),(()=>{const d=Ue();return a(d,n(ve,{get ids(){return t.order},get children(){return n(E,{get each(){return t.order},children:m=>n(q,{key:m})})}})),d})(),n(Ce,{get children(){return n(_e,{get when(){return k()},get children(){const d=Ye();return a(d,()=>D(k())),d}})}})]}}),null),a(b,n(B,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(ae),t.onVisibleChange(re)},get children(){return D("reset")}}),null),i})()]};var Je=async t=>{typeof t=="string"?await navigator.clipboard.writeText(t):await navigator.clipboard.write(t)};const Qe=u('<div class="flex h-4 items-center">'),et=u('<div class="flex h-full flex-col gap-2"><div class="flex w-full flex-wrap items-center gap-2"><div class="tabs-boxed tabs gap-2"></div><div class="flex w-full items-center gap-2 md:flex-1"><input class="input input-primary input-sm flex-1 sm:input-md"><label for="connection-modal" class="btn btn-circle btn-sm sm:btn-md"></label></div></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),tt=u('<button><span></span><div class="badge badge-sm">'),nt=u("<tr>"),st=u('<th class="bg-base-200"><div><div>'),ot=u('<button class="cursor-pointer">'),at=u('<tr class="h-8 hover:!bg-primary hover:text-primary-content">'),rt=u("<td>"),lt=u("<button><div></div><div></div><div>(<!>)");var G=function(t){return t.activeConnections="activeConnections",t.closedConnections="closedConnections",t}(G||{});const mt=()=>{const[t]=oe(),D=ze(),[k,N]=$(""),[L,H]=$(G.activeConnections),q=Ve("connections"),[i,b]=$([],{equals:()=>_()}),[d,m]=$([],{equals:()=>_()}),[_,S]=$(!1),A=e=>r=>{const x=new Map;r.forEach(l=>x.set(l.id,l));const O=e.map(l=>{const w=x.get(l.id);return w?{...l,downloadSpeed:l.download-(w.download??l.download),uploadSpeed:l.upload-(w.upload??l.upload)}:{...l,downloadSpeed:0,uploadSpeed:0}}),T=Ae.differenceWith(r,O,(l,w)=>l.id===w.id);return b(l=>[...l,...T].slice(-1e3)),O.slice(-200)};we(()=>{var x;const e=(x=q())==null?void 0:x.connections;if(!e)return;const r=A(e);m(r)});const f=e=>D.delete(`connections/${e}`),[R,z]=Q($(re),{name:"columnVisibility",storage:localStorage}),[U,le]=Q($(ae),{name:"columnOrder",storage:localStorage}),ce=C(()=>[{header:()=>t("close"),enableGrouping:!1,enableSorting:!1,accessorKey:c.Close,cell:({row:e})=>(()=>{const r=Qe();return a(r,n(B,{class:"btn-circle btn-xs",onClick:()=>f(e.id),get children(){return n(ee,{size:"16"})}})),r})()},{header:()=>t("ID"),enableGrouping:!1,accessorKey:c.ID,accessorFn:e=>e.id},{header:()=>t("type"),accessorKey:c.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{header:()=>t("process"),accessorKey:c.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>t("host"),accessorKey:c.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{header:()=>t("rules"),accessorKey:c.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{header:()=>t("chains"),accessorKey:c.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{header:()=>t("connectTime"),enableGrouping:!1,accessorKey:c.ConnectTime,accessorFn:e=>We(e.start),sortingFn:(e,r)=>te(e.original.start).valueOf()-te(r.original.start).valueOf()},{header:()=>t("dlSpeed"),enableGrouping:!1,accessorKey:c.DlSpeed,accessorFn:e=>`${V(e.downloadSpeed)}/s`,sortingFn:(e,r)=>e.original.downloadSpeed-r.original.downloadSpeed},{header:()=>t("ulSpeed"),enableGrouping:!1,accessorKey:c.ULSpeed,accessorFn:e=>`${V(e.uploadSpeed)}/s`,sortingFn:(e,r)=>e.original.uploadSpeed-r.original.uploadSpeed},{header:()=>t("dl"),enableGrouping:!1,accessorKey:c.Download,accessorFn:e=>V(e.download),sortingFn:(e,r)=>e.original.download-r.original.download},{header:()=>t("ul"),enableGrouping:!1,accessorKey:c.Upload,accessorFn:e=>V(e.upload),sortingFn:(e,r)=>e.original.upload-r.original.upload},{header:()=>t("sourceIP"),accessorKey:c.SourceIP,accessorFn:e=>e.metadata.sourceIP},{header:()=>t("sourcePort"),accessorKey:c.SourcePort,accessorFn:e=>e.metadata.sourcePort},{header:()=>t("destination"),accessorKey:c.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}]),[ie,de]=$([]),[ue,ge]=$([{id:c.ConnectTime,desc:!0}]),Y=Ke({state:{get columnOrder(){return U()},get grouping(){return ie()},get sorting(){return ue()},get columnVisibility(){return R()},get globalFilter(){return k()}},get data(){return L()===G.activeConnections?d():i()},sortDescFirst:!0,enableHiding:!0,columns:ce(),onGlobalFilterChange:N,onGroupingChange:de,onSortingChange:ge,getFilteredRowModel:Me(),getSortedRowModel:Ge(),getExpandedRowModel:ke(),getGroupedRowModel:Ne(),getCoreRowModel:Le()}),me=C(()=>[{type:G.activeConnections,name:t("activeConnections"),count:d().length},{type:G.closedConnections,name:t("closedConnections"),count:i().length}]);return(()=>{const e=et(),r=e.firstChild,x=r.firstChild,O=x.nextSibling,T=O.firstChild,l=T.nextSibling,w=r.nextSibling,Z=w.firstChild,X=Z.firstChild,pe=X.nextSibling;return a(x,n(E,{get each(){return me()},children:o=>(()=>{const g=tt(),s=g.firstChild,y=s.nextSibling;return g.$$click=()=>H(o.type),a(s,()=>o.name),a(y,()=>o.count),P(()=>K(g,M(L()===o.type&&"tab-active","tab tab-sm gap-2 sm:tab-md"))),g})()})),T.$$input=o=>N(o.target.value),a(O,n(B,{class:"btn-circle btn-sm sm:btn-md",onClick:()=>S(o=>!o),get children(){return C(()=>!!_())()?n(Fe,{}):n(De,{})}}),l),a(O,n(B,{class:"btn-circle btn-sm sm:btn-md",onClick:()=>D.delete("connections"),get children(){return n(ee,{})}}),l),a(l,n(Oe,{})),a(r,n(Xe,{get order(){return U()},get visible(){return R()},onOrderChange:o=>{le([...o])},onVisibleChange:o=>z({...o})}),null),a(X,n(E,{get each(){return Y.getHeaderGroups()},children:o=>(()=>{const g=nt();return a(g,n(E,{get each(){return o.headers},children:s=>(()=>{const y=st(),I=y.firstChild,h=I.firstChild;return a(I,(()=>{const p=C(()=>!!s.column.getCanGroup());return()=>p()?(()=>{const v=ot();return j(v,"click",s.column.getToggleGroupingHandler(),!0),a(v,(()=>{const F=C(()=>!!s.column.getIsGrouped());return()=>F()?n(ne,{size:18}):n(se,{size:18})})()),v})():null})(),h),j(h,"click",s.column.getToggleSortingHandler(),!0),a(h,()=>W(s.column.columnDef.header,s.getContext())),a(I,()=>({asc:n(Ee,{}),desc:n(Pe,{})})[s.column.getIsSorted()]??null,null),P(p=>{const v=M("flex items-center gap-2"),F=M(s.column.getCanSort()&&"cursor-pointer select-none","flex-1");return v!==p._v$3&&K(I,p._v$3=v),F!==p._v$4&&K(h,p._v$4=F),p},{_v$3:void 0,_v$4:void 0}),y})()})),g})()})),a(pe,n(E,{get each(){return Y.getRowModel().rows},children:o=>(()=>{const g=at();return a(g,n(E,{get each(){return o.getVisibleCells()},children:s=>(()=>{const y=rt();return y.$$contextmenu=I=>{I.preventDefault(),typeof s.renderValue()=="string"&&Je(s.renderValue())},a(y,(()=>{const I=C(()=>!!s.getIsGrouped());return()=>I()?(()=>{const h=lt(),p=h.firstChild,v=p.nextSibling,F=v.nextSibling,he=F.firstChild,J=he.nextSibling;return J.nextSibling,j(h,"click",o.getToggleExpandedHandler(),!0),a(p,(()=>{const be=C(()=>!!o.getIsExpanded());return()=>be()?n(ne,{size:18}):n(se,{size:18})})()),a(v,()=>W(s.column.columnDef.cell,s.getContext())),a(F,()=>o.subRows.length,J),P(()=>K(h,M(o.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),h})():(()=>{const h=C(()=>!!s.getIsAggregated());return()=>h()?W(s.column.columnDef.aggregatedCell??s.column.columnDef.cell,s.getContext()):(()=>{const p=C(()=>!!s.getIsPlaceholder());return()=>p()?null:W(s.column.columnDef.cell,s.getContext())})()})()})()),y})()})),g})()})),P(o=>{const g=t("search"),s=M(Be(He()),"table table-zebra relative rounded-none");return g!==o._v$&&Re(T,"placeholder",o._v$=g),s!==o._v$2&&K(Z,o._v$2=s),o},{_v$:void 0,_v$2:void 0}),e})()};Te(["input","click","contextmenu"]);export{mt as default};
