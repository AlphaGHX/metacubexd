import{c as E,J as L,f as m,a2 as u,a3 as v,a4 as S,L as b}from"./vendor-d5356dcc.js";function h(s,a,r,n){return s.addEventListener(a,r,n),S(s.removeEventListener.bind(s,a,r,n))}function y(s,a,r,n){const e=()=>{u(v(s)).forEach(c=>{c&&u(v(a)).forEach(i=>h(c,i,r,n))})};typeof s=="function"?L(e):m(e)}function k(s,a,r){const[n,e]=E();return y(s,a,e,r),n}var p=(s,a,r=[])=>{const n=new WebSocket(s,a),e=n.send.bind(n);return n.send=c=>n.readyState==1?e(c):r.push(c),n.addEventListener("open",()=>{for(;r.length;)e(r.shift())}),n},w=(s,a,r={})=>{let n=r.retries||1/0,e;const c=[];let i=[["close",()=>{n-- >0&&setTimeout(d,r.delay||3e3)}]];const d=()=>{e&&e.readyState<2&&e.close(),e=Object.assign(p(s,a,c),{reconnect:d}),i.forEach(t=>e.addEventListener(...t))};d();const f={close:(...t)=>(n=0,e.close(...t)),addEventListener:(...t)=>(i.push(t),e.addEventListener(...t)),removeEventListener:(...t)=>(i=i.filter(o=>t[0]!==o[0]||t[1]!==o[1]),e.removeEventListener(...t)),send:t=>{var o,l;return(l=(o=f.send).before)==null||l.call(o),e.send(t)}};for(let t in e)f[t]==null&&Object.defineProperty(f,t,{enumerable:!0,get:()=>typeof e[t]=="function"?e[t].bind(e):e[t]});return f},O=(s,a,r)=>{const n=w(s,a,r);return b(()=>n.close()),n};export{k as a,O as c};
