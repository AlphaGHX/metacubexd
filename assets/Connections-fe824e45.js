import{u as ee,c as R,i as r,e as s,Y as oe,Z as ce,_ as le,F as T,$ as ie,S as de,a0 as ue,h as $,a1 as ge,a2 as $e,M as me,f as k,m as W,W as pe,x as fe,a3 as H,y as G,b as K,v as be,a4 as ve,a as he,a5 as Se,a6 as _e,g as Y,t as Z,s as Ce,d as xe}from"./vendor-b4827f97.js";import{c as ye}from"./index-6fc17acd.js";import{c as we,f as q,g as Ie,a as Ee,b as Re}from"./index-bdef43b7.js";import{B as j}from"./Button-b7595b70.js";import{d as te,f as ne,u as Fe,w as Oe,c as De,g as d,h as Te,t as Me,T as L}from"./index-1ae7cb74.js";const Ne=$('<div class="sortable"><div class="m-1 flex cursor-grab justify-between p-1"><span class="select-none"></span><input type="checkbox" class="toggle">'),Pe=$('<input type="checkbox" id="connection-modal" class="modal-toggle">'),Ke=$('<div class="column self-stretch">'),Le=$('<div class="sortable">'),ke=$('<div class="modal"><div class="modal-box w-80"></div><label class="modal-backdrop" for="connection-modal">'),Ae=t=>{const[o]=ee(),[f,v]=R(null),S=({draggable:c})=>v(c.id),M=({draggable:c,droppable:b})=>{if(c&&b){const u=t.order,g=u.indexOf(c.id),w=u.indexOf(b.id);if(g!==w){const _=u.slice();_.splice(w,0,..._.splice(g,1)),t.onOrderChange(_)}}},V=({key:c})=>{const b=ge(c),[u]=$e();return(()=>{const g=Ne(),w=g.firstChild,_=w.firstChild,N=_.nextSibling;return me(b,g,()=>!0),r(_,()=>o(c)),N.addEventListener("change",h=>{t.onVisibleChange({...t.visible,[c]:h.target.checked})}),k(h=>{const P=!!b.isActiveDraggable,F=!!u.active.draggable;return P!==h._v$&&g.classList.toggle("opacity-25",h._v$=P),F!==h._v$2&&g.classList.toggle("transition-transform",h._v$2=F),h},{_v$:void 0,_v$2:void 0}),k(()=>N.checked=t.visible[c]),g})()};return[Pe(),(()=>{const c=ke(),b=c.firstChild;return r(b,s(ue,{onDragStart:S,onDragEnd:M,collisionDetector:oe,get children(){return[s(ce,{}),(()=>{const u=Ke();return r(u,s(le,{get ids(){return t.order},get children(){return s(T,{get each(){return t.order},children:g=>s(V,{key:g})})}})),u})(),s(ie,{get children(){return s(de,{get when(){return f()},get children(){const u=Le();return r(u,()=>o(f())),u}})}})]}}),null),r(b,s(j,{class:"btn-neutral btn-sm ml-auto mt-4 block",onClick:()=>{t.onOrderChange(te),t.onVisibleChange(ne)},get children(){return o("reset")}}),null),c})()]};var Ve=async t=>{typeof t=="string"?await navigator.clipboard.writeText(t):await navigator.clipboard.write(t)};const X="[a-fA-F\\d:]",y=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${X})|(?<=${X})(?=\\s|$))`:"",p="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",a="[a-fA-F\\d]{1,4}",A=`
(?:
(?:${a}:){7}(?:${a}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${a}:){6}(?:${p}|:${a}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${a}:){5}(?::${p}|(?::${a}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${a}:){4}(?:(?::${a}){0,1}:${p}|(?::${a}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${a}:){3}(?:(?::${a}){0,2}:${p}|(?::${a}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${a}:){2}(?:(?::${a}){0,3}:${p}|(?::${a}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${a}:){1}(?:(?::${a}){0,4}:${p}|(?::${a}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${a}){0,5}:${p}|(?::${a}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),je=new RegExp(`(?:^${p}$)|(?:^${A}$)`),ze=new RegExp(`^${p}$`),Be=new RegExp(`^${A}$`),z=t=>t&&t.exact?je:new RegExp(`(?:${y(t)}${p}${y(t)})|(?:${y(t)}${A}${y(t)})`,"g");z.v4=t=>t&&t.exact?ze:new RegExp(`${y(t)}${p}${y(t)}`,"g");z.v6=t=>t&&t.exact?Be:new RegExp(`${y(t)}${A}${y(t)}`,"g");function Ue(t){const o=(...f)=>t(...f);return Object.defineProperty(o,"name",{value:`functionTimeout(${t.name||"<anonymous>"})`,configurable:!0}),o}const{toString:We}=Object.prototype;function He(t){return We.call(t)==="[object RegExp]"}const J={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function Ge(t,o={}){if(!He(t))throw new TypeError("Expected a RegExp instance");const f=Object.keys(J).map(S=>(typeof o[S]=="boolean"?o[S]:t[S])?J[S]:"").join(""),v=new RegExp(o.source||t.source,f);return v.lastIndex=typeof o.lastIndex=="number"?o.lastIndex:t.lastIndex,v}function Ye(t,o,{timeout:f}={}){try{return Ue(()=>Ge(t).test(o),{timeout:f})()}catch(v){throw v}}const Ze=45,qe={timeout:400};function Xe(t){return t.length>Ze?!1:Ye(z.v6({exact:!0}),t,qe)}const Q=$("<span>"),Je=$('<div class="flex h-4 items-center">'),Qe=$('<div class="flex h-full flex-col gap-4 overflow-y-auto p-1"><div class="flex w-full items-center gap-2"><input class="input input-primary flex-1"><label for="connection-modal" class="btn btn-circle"></label></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),et=$("<tr>"),tt=$('<th class="bg-base-200"><div>'),nt=$('<tr class="h-8 hover:!bg-primary hover:text-primary-content">'),at=$("<td>"),it=()=>{const[t]=ee(),[o,f]=W(R(ne),{name:"columnVisibility",storage:localStorage}),[v,S]=W(R(te),{name:"columnOrder",storage:localStorage}),M=Fe(),[V,c]=R(""),b=ye(`${Oe()}/connections?token=${De()}`),u=pe(b,"message"),[g,w]=R([]);fe(()=>{var n;const e=(n=u())==null?void 0:n.data;e&&w(O=>{const D=new Map;return O.forEach(m=>D.set(m.id,m)),JSON.parse(e).connections.map(m=>{const C=D.get(m.id);return C?{...m,downloadSpeed:C.download?m.download-C.download:0,uploadSpeed:C.upload?m.upload-C.upload:0}:{...m,downloadSpeed:0,uploadSpeed:0}}).slice(-100)})});const _=e=>M.delete(`connections/${e}`),N=[{accessorKey:d.Close,enableSorting:!1,header:()=>(()=>{const e=Q();return r(e,()=>t("close")),e})(),cell:({row:e})=>(()=>{const n=Je();return r(n,s(j,{class:"btn-circle btn-xs",onClick:()=>_(e.id),get children(){return s(H,{size:"16"})}})),n})()},{accessorKey:d.ID,accessorFn:e=>e.id},{accessorKey:d.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{accessorKey:d.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{accessorKey:d.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{accessorKey:d.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{accessorKey:d.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{accessorKey:d.ConnectTime,accessorFn:e=>Te(e.start),sortingFn:(e,n)=>G(e.original.start).valueOf()-G(n.original.start).valueOf()},{accessorKey:d.DlSpeed,accessorFn:e=>`${K(e.downloadSpeed)}/s`,sortingFn:(e,n)=>e.original.downloadSpeed-n.original.downloadSpeed},{accessorKey:d.ULSpeed,accessorFn:e=>`${K(e.uploadSpeed)}/s`,sortingFn:(e,n)=>e.original.uploadSpeed-n.original.uploadSpeed},{accessorKey:d.Download,accessorFn:e=>K(e.download),sortingFn:(e,n)=>e.original.download-n.original.download},{accessorKey:d.Upload,accessorFn:e=>K(e.upload),sortingFn:(e,n)=>e.original.upload-n.original.upload},{accessorKey:d.Source,accessorFn:e=>Xe(e.metadata.sourceIP)?`[${e.metadata.sourceIP}]:${e.metadata.sourcePort}`:`${e.metadata.sourceIP}:${e.metadata.sourcePort}`},{accessorKey:d.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host}],[h,P]=R([{id:"ID",desc:!0}]),F=we({state:{get columnOrder(){return v()},get sorting(){return h()},get columnVisibility(){return o()},get globalFilter(){return V()}},get data(){return g()},enableHiding:!0,columns:N,onGlobalFilterChange:c,getFilteredRowModel:Ie(),onSortingChange:P,getSortedRowModel:Ee(),getCoreRowModel:Re()}),ae=()=>{const e=Me();return e===L.XS?"table-xs":e===L.SM?"table-sm":e===L.MD?"table-md":e===L.LG?"table-lg":""};return(()=>{const e=Qe(),n=e.firstChild,O=n.firstChild,D=O.nextSibling,B=n.nextSibling,m=B.firstChild,C=m.firstChild,se=C.nextSibling;return O.$$input=l=>c(l.target.value),r(n,s(j,{class:"btn-circle",onClick:()=>M.delete("connections"),get children(){return s(H,{})}}),D),r(D,s(be,{})),r(n,s(Ae,{get order(){return v()},get visible(){return o()},onOrderChange:l=>{S([...l])},onVisibleChange:l=>f({...l})}),null),r(C,s(T,{get each(){return F.getHeaderGroups()},children:l=>(()=>{const x=et();return r(x,s(T,{get each(){return l.headers},children:i=>(()=>{const I=tt(),E=I.firstChild;return ve(E,"click",i.column.getToggleSortingHandler(),!0),r(E,(()=>{const re=he(()=>i.column.id===d.Close);return()=>re()?q(i.column.columnDef.header,i.getContext()):(()=>{const U=Q();return r(U,()=>t(i.column.id)),U})()})(),null),r(E,()=>({asc:s(Se,{}),desc:s(_e,{})})[i.column.getIsSorted()]??null,null),k(()=>Y(E,Z("flex items-center justify-between gap-2",i.column.getCanSort()&&"cursor-pointer select-none"))),I})()})),x})()})),r(se,s(T,{get each(){return F.getRowModel().rows},children:l=>(()=>{const x=nt();return r(x,s(T,{get each(){return l.getVisibleCells()},children:i=>(()=>{const I=at();return I.$$contextmenu=E=>{E.preventDefault(),typeof i.renderValue()=="string"&&Ve(i.renderValue())},r(I,()=>q(i.column.columnDef.cell,i.getContext())),I})()})),x})()})),k(l=>{const x=t("search"),i=Z(ae(),"table table-zebra relative rounded-none");return x!==l._v$&&Ce(O,"placeholder",l._v$=x),i!==l._v$2&&Y(m,l._v$2=i),l},{_v$:void 0,_v$2:void 0}),e})()};xe(["input","click","contextmenu"]);export{it as default};
